[{
  "title": "Suspicious Process Access to LSASS with Dbgcore/Dbghelp DLLs",
  "id": "9f5c1d59-33be-4e60-bcab-85d2f566effd",
  "description": "Detects suspicious process access to LSASS.exe from processes located in uncommon locations with dbgcore.dll or dbghelp.dll in the call trace.\nThese DLLs contain functions like MiniDumpWriteDump that can be abused for credential dumping purposes. While modern tools like Mimikatz have moved to using ntdll.dll,\ndbgcore.dll and dbghelp.dll are still used by basic credential dumping utilities and legacy tools for LSASS memory access and process suspension techniques.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=10 AND ((TargetImage LIKE '%\\\\lsass.exe' ESCAPE '\\' AND (CallTrace LIKE '%dbgcore.dll%' ESCAPE '\\' OR CallTrace LIKE '%dbghelp.dll%' ESCAPE '\\')) AND (SourceImage LIKE '%:\\\\Perflogs\\\\%' ESCAPE '\\' OR SourceImage LIKE '%:\\\\Temp\\\\%' ESCAPE '\\' OR SourceImage LIKE '%:\\\\Users\\\\Public\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\$Recycle.Bin\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\AppData\\\\Roaming\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Contacts\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Desktop\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Documents\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Downloads\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Favorites\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Favourites\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\inetpub\\\\wwwroot\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Music\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Pictures\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Start Menu\\\\Programs\\\\Startup\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Users\\\\Default\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Videos\\\\%' ESCAPE '\\' OR SourceImage LIKE '%\\\\Windows\\\\Temp\\\\%' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001",
    "attack.defense-evasion",
    "attack.t1562.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 2,
      "CallTrace": "C:\\Windows\\SYSTEM32\\ntdll.dll+4595c|C:\\Windows\\SYSTEM32\\ntdll.dll+1d4da|C:\\Windows\\system32\\kernel32.dll+3cc47|C:\\Windows\\system32\\kernel32.dll+3ff99|C:\\Windows\\system32\\dbghelp.dll+4c791|C:\\Windows\\system32\\dbghelp.dll+4dcab|C:\\Windows\\system32\\dbghelp.dll+4a1b8|C:\\Windows\\system32\\dbghelp.dll+45b81|C:\\Windows\\system32\\dbghelp.dll+45e2a|C:\\Users\\IEUser\\Desktop\\procdump.exe+11a8d|C:\\Users\\IEUser\\Desktop\\procdump.exe+116a6|C:\\Users\\IEUser\\Desktop\\procdump.exe+11610|C:\\Users\\IEUser\\Desktop\\procdump.exe+11356|C:\\Windows\\system32\\kernel32.dll+4ef8c|C:\\Windows\\SYSTEM32\\ntdll.dll+6367a|C:\\Windows\\SYSTEM32\\ntdll.dll+6364d",
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "PC04.example.corp",
      "EventID": 10,
      "EventRecordID": 4434,
      "GrantedAccess": "0x1fffff",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_10_11_lsass_memdump.evtx",
      "ProcessID": 344,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SourceImage": "C:\\Users\\IEUser\\Desktop\\procdump.exe",
      "SourceProcessGUID": "365ABB72-9B75-5C8E-0000-0010013F1200",
      "SourceProcessId": 1856,
      "SourceThreadId": 980,
      "SystemTime": "2019-03-17T19:09:41.328868Z",
      "TargetImage": "C:\\Windows\\system32\\lsass.exe",
      "TargetProcessGUID": "365ABB72-0886-5C8F-0000-001030560000",
      "TargetProcessId": 476,
      "Task": 10,
      "ThreadID": 2032,
      "UserID": "S-1-5-18",
      "UtcTime": "2019-03-17 19:09:41.328",
      "Version": 3
    }
  ]
},
{
  "title": "LSASS Memory Access by Tool With Dump Keyword In Name",
  "id": "9bd012ee-0dff-44d7-84a0-aa698cfd87a3",
  "description": "Detects LSASS process access requests from a source process with the \"dump\" keyword in its image name.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=10 AND (TargetImage LIKE '%\\\\lsass.exe' ESCAPE '\\' AND SourceImage LIKE '%dump%' ESCAPE '\\' AND (GrantedAccess LIKE '%10' ESCAPE '\\' OR GrantedAccess LIKE '%30' ESCAPE '\\' OR GrantedAccess LIKE '%50' ESCAPE '\\' OR GrantedAccess LIKE '%70' ESCAPE '\\' OR GrantedAccess LIKE '%90' ESCAPE '\\' OR GrantedAccess LIKE '%B0' ESCAPE '\\' OR GrantedAccess LIKE '%D0' ESCAPE '\\' OR GrantedAccess LIKE '%F0' ESCAPE '\\' OR GrantedAccess LIKE '%18' ESCAPE '\\' OR GrantedAccess LIKE '%38' ESCAPE '\\' OR GrantedAccess LIKE '%58' ESCAPE '\\' OR GrantedAccess LIKE '%78' ESCAPE '\\' OR GrantedAccess LIKE '%98' ESCAPE '\\' OR GrantedAccess LIKE '%B8' ESCAPE '\\' OR GrantedAccess LIKE '%D8' ESCAPE '\\' OR GrantedAccess LIKE '%F8' ESCAPE '\\' OR GrantedAccess LIKE '%1A' ESCAPE '\\' OR GrantedAccess LIKE '%3A' ESCAPE '\\' OR GrantedAccess LIKE '%5A' ESCAPE '\\' OR GrantedAccess LIKE '%7A' ESCAPE '\\' OR GrantedAccess LIKE '%9A' ESCAPE '\\' OR GrantedAccess LIKE '%BA' ESCAPE '\\' OR GrantedAccess LIKE '%DA' ESCAPE '\\' OR GrantedAccess LIKE '%FA' ESCAPE '\\' OR GrantedAccess LIKE '%0x14C2' ESCAPE '\\' OR GrantedAccess LIKE '%FF' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001",
    "attack.s0002"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 2,
      "CallTrace": "C:\\Windows\\SYSTEM32\\ntdll.dll+4595c|C:\\Windows\\SYSTEM32\\ntdll.dll+1d4da|C:\\Windows\\system32\\kernel32.dll+3cc47|C:\\Windows\\system32\\kernel32.dll+3ff99|C:\\Windows\\system32\\dbghelp.dll+4c791|C:\\Windows\\system32\\dbghelp.dll+4dcab|C:\\Windows\\system32\\dbghelp.dll+4a1b8|C:\\Windows\\system32\\dbghelp.dll+45b81|C:\\Windows\\system32\\dbghelp.dll+45e2a|C:\\Users\\IEUser\\Desktop\\procdump.exe+11a8d|C:\\Users\\IEUser\\Desktop\\procdump.exe+116a6|C:\\Users\\IEUser\\Desktop\\procdump.exe+11610|C:\\Users\\IEUser\\Desktop\\procdump.exe+11356|C:\\Windows\\system32\\kernel32.dll+4ef8c|C:\\Windows\\SYSTEM32\\ntdll.dll+6367a|C:\\Windows\\SYSTEM32\\ntdll.dll+6364d",
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "PC04.example.corp",
      "EventID": 10,
      "EventRecordID": 4434,
      "GrantedAccess": "0x1fffff",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_10_11_lsass_memdump.evtx",
      "ProcessID": 344,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SourceImage": "C:\\Users\\IEUser\\Desktop\\procdump.exe",
      "SourceProcessGUID": "365ABB72-9B75-5C8E-0000-0010013F1200",
      "SourceProcessId": 1856,
      "SourceThreadId": 980,
      "SystemTime": "2019-03-17T19:09:41.328868Z",
      "TargetImage": "C:\\Windows\\system32\\lsass.exe",
      "TargetProcessGUID": "365ABB72-0886-5C8F-0000-001030560000",
      "TargetProcessId": 476,
      "Task": 10,
      "ThreadID": 2032,
      "UserID": "S-1-5-18",
      "UtcTime": "2019-03-17 19:09:41.328",
      "Version": 3
    }
  ]
},
{
  "title": "LSASS Process Memory Dump Creation Via Taskmgr.EXE",
  "id": "69ca12af-119d-44ed-b50f-a47af0ebc364",
  "description": "Detects the creation of an \"lsass.dmp\" file by the taskmgr process. This indicates a manual dumping of the LSASS.exe process memory using Windows Task Manager.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=11 AND ((Image LIKE '%:\\\\Windows\\\\system32\\\\taskmgr.exe' ESCAPE '\\' OR Image LIKE '%:\\\\Windows\\\\SysWOW64\\\\taskmgr.exe' ESCAPE '\\') AND (TargetFilename LIKE '%\\\\AppData\\\\Local\\\\Temp\\\\%' ESCAPE '\\' AND TargetFilename LIKE '%\\\\lsass%' ESCAPE '\\' AND TargetFilename LIKE '%.DMP%' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "PC04.example.corp",
      "CreationUtcTime": "2019-03-17 19:10:02.058",
      "EventID": 11,
      "EventRecordID": 4441,
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Windows\\system32\\taskmgr.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_10_11_lsass_memdump.evtx",
      "ProcessGuid": "365ABB72-9B85-5C8E-0000-0010C4CC1200",
      "ProcessID": 344,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2019-03-17T19:10:03.991455Z",
      "TargetFileName": "C:\\Users\\IEUser\\AppData\\Local\\Temp\\lsass (2).DMP",
      "Task": 11,
      "ThreadID": 2032,
      "UserID": "S-1-5-18",
      "UtcTime": "2019-03-17 19:10:02.058",
      "Version": 2
    }
  ]
},
{
  "title": "LSASS Process Memory Dump Files",
  "id": "a5a2d357-1ab8-4675-a967-ef9990a59391",
  "description": "Detects creation of files with names used by different memory dumping tools to create a memory dump of the LSASS process memory, which contains user credentials.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=11 AND ((TargetFilename LIKE '%\\\\Andrew.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\Coredump.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsass.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsass.rar' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsass.zip' ESCAPE '\\' OR TargetFilename LIKE '%\\\\NotLSASS.zip' ESCAPE '\\' OR TargetFilename LIKE '%\\\\PPLBlade.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\rustive.dmp' ESCAPE '\\') OR (TargetFilename LIKE '%\\\\lsass\\_2%' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsassdmp%' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsassdump%' ESCAPE '\\') OR (TargetFilename LIKE '%\\\\lsass%' ESCAPE '\\' AND TargetFilename LIKE '%.dmp%' ESCAPE '\\') OR (TargetFilename LIKE '%SQLDmpr%' ESCAPE '\\' AND TargetFilename LIKE '%.mdmp' ESCAPE '\\') OR ((TargetFilename LIKE '%\\\\nanodump%' ESCAPE '\\' OR TargetFilename LIKE '%\\\\proc\\_%' ESCAPE '\\') AND TargetFilename LIKE '%.dmp' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "PC04.example.corp",
      "CreationUtcTime": "2019-03-17 19:09:41.318",
      "EventID": 11,
      "EventRecordID": 4433,
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Users\\IEUser\\Desktop\\procdump.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_10_11_lsass_memdump.evtx",
      "ProcessGuid": "365ABB72-9B75-5C8E-0000-0010013F1200",
      "ProcessID": 344,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2019-03-17T19:09:41.328868Z",
      "TargetFileName": "C:\\Users\\IEUser\\Desktop\\lsass.exe_190317_120941.dmp",
      "Task": 11,
      "ThreadID": 2032,
      "UserID": "S-1-5-18",
      "UtcTime": "2019-03-17 19:09:41.318",
      "Version": 2
    },
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "PC04.example.corp",
      "CreationUtcTime": "2019-03-17 19:10:02.058",
      "EventID": 11,
      "EventRecordID": 4441,
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Windows\\system32\\taskmgr.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_10_11_lsass_memdump.evtx",
      "ProcessGuid": "365ABB72-9B85-5C8E-0000-0010C4CC1200",
      "ProcessID": 344,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2019-03-17T19:10:03.991455Z",
      "TargetFileName": "C:\\Users\\IEUser\\AppData\\Local\\Temp\\lsass (2).DMP",
      "Task": 11,
      "ThreadID": 2032,
      "UserID": "S-1-5-18",
      "UtcTime": "2019-03-17 19:10:02.058",
      "Version": 2
    }
  ]
}]