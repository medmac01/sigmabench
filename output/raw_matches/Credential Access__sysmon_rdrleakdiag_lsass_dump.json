[{
  "title": "Potential Credential Dumping Via LSASS Process Clone",
  "id": "c8da0dfd-4ed0-4b68-962d-13c9c884384e",
  "description": "Detects a suspicious LSASS process process clone that could be a sign of credential dumping activity",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (ParentImage LIKE '%\\\\Windows\\\\System32\\\\lsass.exe' ESCAPE '\\' AND Image LIKE '%\\\\Windows\\\\System32\\\\lsass.exe' ESCAPE '\\'))"
  ],
  "rule_level": "critical",
  "tags": [
    "attack.credential-access",
    "attack.t1003",
    "attack.t1003.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\WINDOWS\\system32\\lsass.exe",
      "Company": "Microsoft Corporation",
      "Computer": "DESKTOP-PIU87N6",
      "CurrentDirectory": "C:\\WINDOWS\\system32\\",
      "Description": "Local Security Authority Process",
      "EventID": 1,
      "EventRecordID": 5228,
      "FileVersion": "10.0.19041.488 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "MD5=BBBA8CE22384213070D0B9511EA181C5,SHA256=C41F0ECA09CBCEC776E807522C048A9E7A2D92CC3B4ECCDE2F8F6C42536AD094,IMPHASH=09FDE88C65E2BC5F1F90E96B673C52B1",
      "IMPHASH": "09FDE88C65E2BC5F1F90E96B673C52B1",
      "Image": "C:\\Windows\\System32\\lsass.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "BC47D85C-FAA9-5F68-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "BBBA8CE22384213070D0B9511EA181C5",
      "Opcode": 0,
      "OriginalFileName": "lsass.exe",
      "OriginalLogfile": "sysmon_rdrleakdiag_lsass_dump.evtx",
      "ParentCommandLine": "C:\\WINDOWS\\system32\\lsass.exe",
      "ParentImage": "C:\\Windows\\System32\\lsass.exe",
      "ParentProcessGuid": "BC47D85C-FAA9-5F68-0000-0010D9590000",
      "ParentProcessId": 668,
      "ProcessGuid": "BC47D85C-DB68-5F71-0000-00109138AB01",
      "ProcessID": 2848,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA256": "C41F0ECA09CBCEC776E807522C048A9E7A2D92CC3B4ECCDE2F8F6C42536AD094",
      "SystemTime": "2020-09-28T12:47:36.215504Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 2328,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-09-28 12:47:36.212",
      "Version": 5
    }
  ]
},
{
  "title": "Process Memory Dump via RdrLeakDiag.EXE",
  "id": "edadb1e5-5919-4e4c-8462-a9e643b02c4b",
  "description": "Detects the use of the Microsoft Windows Resource Leak Diagnostic tool \"rdrleakdiag.exe\" to dump process memory",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\rdrleakdiag.exe' ESCAPE '\\' OR OriginalFileName='RdrLeakDiag.exe') AND (CommandLine LIKE '%-memdmp%' ESCAPE '\\' OR CommandLine LIKE '%/memdmp%' ESCAPE '\\' OR CommandLine LIKE '%–memdmp%' ESCAPE '\\' OR CommandLine LIKE '%—memdmp%' ESCAPE '\\' OR CommandLine LIKE '%―memdmp%' ESCAPE '\\' OR CommandLine LIKE '%fullmemdmp%' ESCAPE '\\') AND (CommandLine LIKE '% -o %' ESCAPE '\\' OR CommandLine LIKE '% /o %' ESCAPE '\\' OR CommandLine LIKE '% –o %' ESCAPE '\\' OR CommandLine LIKE '% —o %' ESCAPE '\\' OR CommandLine LIKE '% ―o %' ESCAPE '\\' OR CommandLine LIKE '% -p %' ESCAPE '\\' OR CommandLine LIKE '% /p %' ESCAPE '\\' OR CommandLine LIKE '% –p %' ESCAPE '\\' OR CommandLine LIKE '% —p %' ESCAPE '\\' OR CommandLine LIKE '% ―p %' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "rdrleakdiag.exe  /p 668 /o C:\\Users\\wanwan\\Desktop /fullmemdmp /snap",
      "Company": "Microsoft Corporation",
      "Computer": "DESKTOP-PIU87N6",
      "CurrentDirectory": "C:\\Users\\wanwan\\Desktop\\SysinternalsSuite\\",
      "Description": "Microsoft Windows Resource Leak Diagnostic",
      "EventID": 1,
      "EventRecordID": 5226,
      "FileVersion": "10.0.19041.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "MD5=C04F4FB2C7B44E19E85908459D3F0085,SHA256=D66E1EE7970598A5F34FD4B468B5B7705219E80A8A2784E7B18564831FCA797C,IMPHASH=5D87ACDE58B6E042FB38FE42B86E9C25",
      "IMPHASH": "5D87ACDE58B6E042FB38FE42B86E9C25",
      "Image": "C:\\Windows\\System32\\rdrleakdiag.exe",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "BC47D85C-6E10-5F68-0000-0020900B0300",
      "LogonId": "0x30b90",
      "MD5": "C04F4FB2C7B44E19E85908459D3F0085",
      "Opcode": 0,
      "OriginalFileName": "RdrLeakDiag.exe",
      "OriginalLogfile": "sysmon_rdrleakdiag_lsass_dump.evtx",
      "ParentCommandLine": "\"C:\\WINDOWS\\system32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "BC47D85C-9569-5F71-0000-0010D9FD8300",
      "ParentProcessId": 1456,
      "ProcessGuid": "BC47D85C-DB68-5F71-0000-0010B237AB01",
      "ProcessID": 2848,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA256": "D66E1EE7970598A5F34FD4B468B5B7705219E80A8A2784E7B18564831FCA797C",
      "SystemTime": "2020-09-28T12:47:36.197943Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 2328,
      "User": "DESKTOP-PIU87N6\\wanwan",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-09-28 12:47:36.192",
      "Version": 5
    }
  ]
}]