[{
  "title": "Explorer Process Tree Break",
  "id": "949f1ffb-6e85-4f00-ae1e-c3c5b190d605",
  "description": "Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries,\nwhich is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from \"svchost\"\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (CommandLine LIKE '%/factory,{75dff2b7-6936-4c06-a8bb-676a7b00b24b}%' ESCAPE '\\' OR (CommandLine LIKE '%explorer.exe%' ESCAPE '\\' AND (CommandLine LIKE '% -root,%' ESCAPE '\\' OR CommandLine LIKE '% /root,%' ESCAPE '\\' OR CommandLine LIKE '% –root,%' ESCAPE '\\' OR CommandLine LIKE '% —root,%' ESCAPE '\\' OR CommandLine LIKE '% ―root,%' ESCAPE '\\'))))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 2,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "explorer.exe  /root,\"c:\\windows\\System32\\calc.exe\"",
      "Company": "Microsoft Corporation",
      "Computer": "win10.ecorp.com",
      "CurrentDirectory": "C:\\Users\\Administrator.ECORP\\",
      "Description": "Windows Explorer",
      "EventID": 1,
      "EventRecordID": 400702,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=59AB8548708342C77C51F70EEC5CED0A88DC4701,MD5=6A65873EA949C5CCC72DDEF9E9780AA5,SHA256=16656BBB748BA1C811BB2C68D987DC0F5CAF149E41A84E45F6B6ECAAF7D29AB2,IMPHASH=0B98A47B3DAF2EE45939EF2A0F188959",
      "IMPHASH": "0B98A47B3DAF2EE45939EF2A0F188959",
      "Image": "C:\\Windows\\explorer.exe",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "6661D424-948B-5EEF-0000-002072300F00",
      "LogonId": "0xf3072",
      "MD5": "6A65873EA949C5CCC72DDEF9E9780AA5",
      "Opcode": 0,
      "OriginalFileName": "EXPLORER.EXE",
      "OriginalLogfile": "susp_explorer_exec_root_cmdline_@rimpq_@CyberRaiju.evtx",
      "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "6661D424-EC73-5EFE-0000-00109FEA6300",
      "ParentProcessId": 6292,
      "ProcessGuid": "6661D424-F4F6-5EFE-0000-0010E7EFF800",
      "ProcessID": 1444,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "59AB8548708342C77C51F70EEC5CED0A88DC4701",
      "SHA256": "16656BBB748BA1C811BB2C68D987DC0F5CAF149E41A84E45F6B6ECAAF7D29AB2",
      "SystemTime": "2020-07-03T09:05:58.278154Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 3796,
      "User": "ECORP\\Administrator",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-07-03 09:05:58.268",
      "Version": 5
    },
    {
      "row_id": 4,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\explorer.exe /factory,{75dff2b7-6936-4c06-a8bb-676a7b00b24b} -Embedding",
      "Company": "Microsoft Corporation",
      "Computer": "win10.ecorp.com",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Windows Explorer",
      "EventID": 1,
      "EventRecordID": 400704,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=59AB8548708342C77C51F70EEC5CED0A88DC4701,MD5=6A65873EA949C5CCC72DDEF9E9780AA5,SHA256=16656BBB748BA1C811BB2C68D987DC0F5CAF149E41A84E45F6B6ECAAF7D29AB2,IMPHASH=0B98A47B3DAF2EE45939EF2A0F188959",
      "IMPHASH": "0B98A47B3DAF2EE45939EF2A0F188959",
      "Image": "C:\\Windows\\explorer.exe",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "6661D424-948B-5EEF-0000-002072300F00",
      "LogonId": "0xf3072",
      "MD5": "6A65873EA949C5CCC72DDEF9E9780AA5",
      "Opcode": 0,
      "OriginalFileName": "EXPLORER.EXE",
      "OriginalLogfile": "susp_explorer_exec_root_cmdline_@rimpq_@CyberRaiju.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\svchost.exe -k DcomLaunch -p",
      "ParentImage": "C:\\Windows\\System32\\svchost.exe",
      "ParentProcessGuid": "6661D424-9438-5EEF-0000-00104DA20000",
      "ParentProcessId": 792,
      "ProcessGuid": "6661D424-F4F6-5EFE-0000-0010A2F6F800",
      "ProcessID": 1444,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "59AB8548708342C77C51F70EEC5CED0A88DC4701",
      "SHA256": "16656BBB748BA1C811BB2C68D987DC0F5CAF149E41A84E45F6B6ECAAF7D29AB2",
      "SystemTime": "2020-07-03T09:05:58.367330Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 3796,
      "User": "ECORP\\Administrator",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-07-03 09:05:58.333",
      "Version": 5
    }
  ]
}]