[{
  "title": "Suspicious Program Names",
  "id": "efdd8dd5-cee8-4e59-9390-7d4d5e4dd6f6",
  "description": "Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (((Image LIKE '%\\\\CVE-202%' ESCAPE '\\' OR Image LIKE '%\\\\CVE202%' ESCAPE '\\') OR (Image LIKE '%\\\\poc.exe' ESCAPE '\\' OR Image LIKE '%\\\\artifact.exe' ESCAPE '\\' OR Image LIKE '%\\\\artifact64.exe' ESCAPE '\\' OR Image LIKE '%\\\\artifact\\_protected.exe' ESCAPE '\\' OR Image LIKE '%\\\\artifact32.exe' ESCAPE '\\' OR Image LIKE '%\\\\artifact32big.exe' ESCAPE '\\' OR Image LIKE '%obfuscated.exe' ESCAPE '\\' OR Image LIKE '%obfusc.exe' ESCAPE '\\' OR Image LIKE '%\\\\meterpreter' ESCAPE '\\')) OR (CommandLine LIKE '%inject.ps1%' ESCAPE '\\' OR CommandLine LIKE '%Invoke-CVE%' ESCAPE '\\' OR CommandLine LIKE '%pupy.ps1%' ESCAPE '\\' OR CommandLine LIKE '%payload.ps1%' ESCAPE '\\' OR CommandLine LIKE '%beacon.ps1%' ESCAPE '\\' OR CommandLine LIKE '%PowerView.ps1%' ESCAPE '\\' OR CommandLine LIKE '%bypass.ps1%' ESCAPE '\\' OR CommandLine LIKE '%obfuscated.ps1%' ESCAPE '\\' OR CommandLine LIKE '%obfusc.ps1%' ESCAPE '\\' OR CommandLine LIKE '%obfus.ps1%' ESCAPE '\\' OR CommandLine LIKE '%obfs.ps1%' ESCAPE '\\' OR CommandLine LIKE '%evil.ps1%' ESCAPE '\\' OR CommandLine LIKE '%MiniDogz.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\_enc.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\shell.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\rshell.ps1%' ESCAPE '\\' OR CommandLine LIKE '%revshell.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\av.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\av\\_test.ps1%' ESCAPE '\\' OR CommandLine LIKE '%adrecon.ps1%' ESCAPE '\\' OR CommandLine LIKE '%mimikatz.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\PowerUp\\_%' ESCAPE '\\' OR CommandLine LIKE '%powerup.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\Temp\\\\a.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\Temp\\\\p.ps1%' ESCAPE '\\' OR CommandLine LIKE '%\\\\Temp\\\\1.ps1%' ESCAPE '\\' OR CommandLine LIKE '%Hound.ps1%' ESCAPE '\\' OR CommandLine LIKE '%encode.ps1%' ESCAPE '\\' OR CommandLine LIKE '%powercat.ps1%' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.execution",
    "attack.t1059"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "POC.exe",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\POC\\bin\\Debug\\",
      "Description": "SearchIndexer",
      "EventID": 1,
      "EventRecordID": 410485,
      "FileVersion": "1.0.0.0",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=3DA62D5328C591481C9C262BC3A77E5FF32EDBB6,MD5=15661E68D8031891DF6E0E70B547AEBB,SHA256=BEF67963D92D027E39CC5FC927805A4EBFE58C2121BA9396356EF0CE257D0C92,IMPHASH=F34D5F2D4577ED6D9CEEC516C1F5A744",
      "IMPHASH": "F34D5F2D4577ED6D9CEEC516C1F5A744",
      "Image": "C:\\Users\\Public\\POC\\bin\\Debug\\POC.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-18F5-5F76-0000-002073A80500",
      "LogonId": "0x5a873",
      "MD5": "15661E68D8031891DF6E0E70B547AEBB",
      "Opcode": 0,
      "OriginalFileName": "POC.exe",
      "OriginalLogfile": "eop_appcontainer_il_broker_filewrite.evtx",
      "ParentCommandLine": "\"C:\\Windows\\System32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "747F3D96-1EB6-5F76-0000-00101DF51D00",
      "ParentProcessId": 8072,
      "ProcessGuid": "747F3D96-2156-5F76-0000-0010DBE82500",
      "ProcessID": 3308,
      "Product": "SearchIndexer",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "3DA62D5328C591481C9C262BC3A77E5FF32EDBB6",
      "SHA256": "BEF67963D92D027E39CC5FC927805A4EBFE58C2121BA9396356EF0CE257D0C92",
      "SystemTime": "2020-10-01T18:35:02.415351Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4656,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-10-01 18:35:02.413",
      "Version": 5
    },
    {
      "row_id": 2,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "Program",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\POC\\bin\\Debug\\",
      "Description": "SearchIndexer",
      "EventID": 1,
      "EventRecordID": 410486,
      "FileVersion": "1.0.0.0",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=3DA62D5328C591481C9C262BC3A77E5FF32EDBB6,MD5=15661E68D8031891DF6E0E70B547AEBB,SHA256=BEF67963D92D027E39CC5FC927805A4EBFE58C2121BA9396356EF0CE257D0C92,IMPHASH=F34D5F2D4577ED6D9CEEC516C1F5A744",
      "IMPHASH": "F34D5F2D4577ED6D9CEEC516C1F5A744",
      "Image": "C:\\Users\\Public\\POC\\bin\\Debug\\POC.exe",
      "IntegrityLevel": "AppContainer",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-18F5-5F76-0000-002073A80500",
      "LogonId": "0x5a873",
      "MD5": "15661E68D8031891DF6E0E70B547AEBB",
      "Opcode": 0,
      "OriginalFileName": "POC.exe",
      "OriginalLogfile": "eop_appcontainer_il_broker_filewrite.evtx",
      "ParentCommandLine": "POC.exe",
      "ParentImage": "C:\\Users\\Public\\POC\\bin\\Debug\\POC.exe",
      "ParentProcessGuid": "747F3D96-2156-5F76-0000-0010DBE82500",
      "ParentProcessId": 4696,
      "ProcessGuid": "747F3D96-2156-5F76-0000-00100EEC2500",
      "ProcessID": 3308,
      "Product": "SearchIndexer",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "3DA62D5328C591481C9C262BC3A77E5FF32EDBB6",
      "SHA256": "BEF67963D92D027E39CC5FC927805A4EBFE58C2121BA9396356EF0CE257D0C92",
      "SystemTime": "2020-10-01T18:35:02.606952Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4656,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-10-01 18:35:02.605",
      "Version": 5
    }
  ]
},
{
  "title": "Windows Binaries Write Suspicious Extensions",
  "id": "b8fd0e93-ff58-4cbd-8f48-1c114e342e62",
  "description": "Detects Windows executables that write files with suspicious extensions",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=11 AND ((((Image LIKE '%\\\\csrss.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsass.exe' ESCAPE '\\' OR Image LIKE '%\\\\RuntimeBroker.exe' ESCAPE '\\' OR Image LIKE '%\\\\sihost.exe' ESCAPE '\\' OR Image LIKE '%\\\\smss.exe' ESCAPE '\\' OR Image LIKE '%\\\\wininit.exe' ESCAPE '\\' OR Image LIKE '%\\\\winlogon.exe' ESCAPE '\\') AND (TargetFilename LIKE '%.bat' ESCAPE '\\' OR TargetFilename LIKE '%.dll' ESCAPE '\\' OR TargetFilename LIKE '%.exe' ESCAPE '\\' OR TargetFilename LIKE '%.hta' ESCAPE '\\' OR TargetFilename LIKE '%.iso' ESCAPE '\\' OR TargetFilename LIKE '%.ps1' ESCAPE '\\' OR TargetFilename LIKE '%.txt' ESCAPE '\\' OR TargetFilename LIKE '%.vbe' ESCAPE '\\' OR TargetFilename LIKE '%.vbs' ESCAPE '\\')) OR ((Image LIKE '%\\\\dllhost.exe' ESCAPE '\\' OR Image LIKE '%\\\\rundll32.exe' ESCAPE '\\' OR Image LIKE '%\\\\svchost.exe' ESCAPE '\\') AND (TargetFilename LIKE '%.bat' ESCAPE '\\' OR TargetFilename LIKE '%.hta' ESCAPE '\\' OR TargetFilename LIKE '%.iso' ESCAPE '\\' OR TargetFilename LIKE '%.ps1' ESCAPE '\\' OR TargetFilename LIKE '%.vbe' ESCAPE '\\' OR TargetFilename LIKE '%.vbs' ESCAPE '\\'))) AND (NOT ((Image LIKE 'C:\\\\Windows\\\\System32\\\\dllhost.exe' ESCAPE '\\' AND (TargetFilename LIKE '%:\\\\Users\\\\%' ESCAPE '\\' AND TargetFilename LIKE '%\\\\AppData\\\\Local\\\\Temp\\\\\\_\\_PSScriptPolicyTest\\_%' ESCAPE '\\') AND TargetFilename LIKE '%.ps1' ESCAPE '\\') OR (Image LIKE 'C:\\\\Windows\\\\system32\\\\svchost.exe' ESCAPE '\\' AND (TargetFilename LIKE '%C:\\\\Windows\\\\System32\\\\GroupPolicy\\\\DataStore\\\\%' ESCAPE '\\' AND TargetFilename LIKE '%\\\\sysvol\\\\%' ESCAPE '\\' AND TargetFilename LIKE '%\\\\Policies\\\\%' ESCAPE '\\' AND TargetFilename LIKE '%\\\\Machine\\\\Scripts\\\\Startup\\\\%' ESCAPE '\\') AND (TargetFilename LIKE '%.ps1' ESCAPE '\\' OR TargetFilename LIKE '%.bat' ESCAPE '\\')) OR (Image LIKE 'C:\\\\Windows\\\\system32\\\\svchost.exe' ESCAPE '\\' AND (TargetFilename LIKE '%C:\\\\Program Files\\\\WindowsApps\\\\Clipchamp%' ESCAPE '\\' AND TargetFilename LIKE '%.ps1%' ESCAPE '\\')) OR ((Image LIKE 'C:\\\\Windows\\\\system32\\\\svchost.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Windows\\\\SysWOW64\\\\svchost.exe' ESCAPE '\\') AND (TargetFilename LIKE 'C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.PowerShellPreview%' ESCAPE '\\' OR TargetFilename LIKE 'C:\\\\Program Files (x86)\\\\WindowsApps\\\\Microsoft.PowerShellPreview%' ESCAPE '\\') AND TargetFilename LIKE '%.ps1' ESCAPE '\\')))))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "CreationUtcTime": "2020-10-01 18:35:02.768",
      "EventID": 11,
      "EventRecordID": 410487,
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Windows\\System32\\RuntimeBroker.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "eop_appcontainer_il_broker_filewrite.evtx",
      "ProcessGuid": "747F3D96-1903-5F76-0000-0010B85E0900",
      "ProcessID": 3308,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2020-10-01T18:35:02.775302Z",
      "TargetFileName": "C:\\Users\\IEUser\\AppData\\Local\\Microsoft\\abc.txt",
      "Task": 11,
      "ThreadID": 4656,
      "UserID": "S-1-5-18",
      "UtcTime": "2020-10-01 18:35:02.768",
      "Version": 2
    }
  ]
}]