[{
  "title": "Suspicious Script Execution From Temp Folder",
  "id": "a6a39bdb-935c-4f0a-ab77-35f4bbf44d33",
  "description": "Detects a suspicious script executions from temporary folder",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (((Image LIKE '%\\\\powershell.exe' ESCAPE '\\' OR Image LIKE '%\\\\pwsh.exe' ESCAPE '\\' OR Image LIKE '%\\\\mshta.exe' ESCAPE '\\' OR Image LIKE '%\\\\wscript.exe' ESCAPE '\\' OR Image LIKE '%\\\\cscript.exe' ESCAPE '\\') AND (CommandLine LIKE '%\\\\Windows\\\\Temp%' ESCAPE '\\' OR CommandLine LIKE '%\\\\Temporary Internet%' ESCAPE '\\' OR CommandLine LIKE '%\\\\AppData\\\\Local\\\\Temp%' ESCAPE '\\' OR CommandLine LIKE '%\\\\AppData\\\\Roaming\\\\Temp%' ESCAPE '\\' OR CommandLine LIKE '%\\%TEMP\\%%' ESCAPE '\\' OR CommandLine LIKE '%\\%TMP\\%%' ESCAPE '\\' OR CommandLine LIKE '%\\%LocalAppData\\%\\\\Temp%' ESCAPE '\\')) AND (NOT (CommandLine LIKE '% >%' ESCAPE '\\' OR CommandLine LIKE '%Out-File%' ESCAPE '\\' OR CommandLine LIKE '%ConvertTo-Json%' ESCAPE '\\' OR CommandLine LIKE '%-WindowStyle hidden -Verb runAs%' ESCAPE '\\' OR CommandLine LIKE '%\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\Temp\\\\Amazon\\\\EC2-Windows\\\\%' ESCAPE '\\'))))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.execution",
    "attack.t1059"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 5,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\System32\\wscript.exe\" /e:JScript.Encode /nologo C:\\Users\\IEUser\\AppData\\Local\\Temp\\info.txt",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\IEUser\\AppData\\Local\\Temp\\",
      "Description": "Microsoft ® Windows Based Script Host",
      "EventID": 1,
      "EventRecordID": 4865,
      "FileVersion": "5.812.10240.16384",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=5D7F2AFD2FF69D379B69DD94033B51EC537E8E52,MD5=F2748908C6B873CB1970DF4C07223E72,SHA256=0FBB4F848D9FB14D7BF81B0454203810869C527C3435E8747A2213DD86F8129A,IMPHASH=3602F3C025378F418F804C5D183603FE",
      "IMPHASH": "3602F3C025378F418F804C5D183603FE",
      "Image": "C:\\Windows\\SysWOW64\\wscript.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-6053-5D3F-0000-0020B5314100",
      "LogonId": "0x4131b5",
      "MD5": "F2748908C6B873CB1970DF4C07223E72",
      "Opcode": 0,
      "OriginalLogfile": "sysmon_1_11_rundll32_cpl_ostap.evtx",
      "ParentCommandLine": "\"C:\\Windows\\SysWOW64\\rundll32.exe\" \"C:\\Windows\\SysWOW64\\shell32.dll\",#44 \"C:\\Users\\IEUser\\Downloads\\Invoice@0582.cpl\",",
      "ParentImage": "C:\\Windows\\SysWOW64\\rundll32.exe",
      "ParentProcessGuid": "747F3D96-60F5-5D3F-0000-0010A8D75500",
      "ParentProcessId": 4884,
      "ProcessGuid": "747F3D96-60F7-5D3F-0000-00106F2F5600",
      "ProcessID": 2640,
      "Product": "Microsoft ® Windows Script Host",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "5D7F2AFD2FF69D379B69DD94033B51EC537E8E52",
      "SHA256": "0FBB4F848D9FB14D7BF81B0454203810869C527C3435E8747A2213DD86F8129A",
      "SystemTime": "2019-07-29T21:11:19.098105Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 3476,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2019-07-29 21:11:19.010",
      "Version": 5
    }
  ]
}]