[{
  "title": "Hacktool Execution - Imphash",
  "id": "24e3e58a-646b-4b50-adef-02ef935b9fc8",
  "description": "Detects the execution of different Windows based hacktools via their import hash (imphash) even if the files have been renamed",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Hashes LIKE '%IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3A19059BD7688CB88E70005F18EFC439%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=bf6223a49e45d99094406777eb6004ba%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=F9A28C458284584A93B14216308D31BD%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=6118619783FC175BC7EBECFF0769B46E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=563233BFA169ACC7892451F71AD5850A%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=87575CB7A0E0700EB37F2E3668671A08%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=13F08707F759AF6003837A150A371BA1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=1781F06048A7E58B323F0B9259BE798B%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=713C29B396B907ED71A72482759ED757%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=8B114550386E31895DFAB371E741123D%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=9D68781980370E00E0BD939EE5E6C141%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=B18A1401FF8F444056D29450FBC0A6CE%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=CB567F9498452721D77A451374955F5F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=730073214094CD328547BF1F72289752%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=17B461A082950FC6332228572138B80C%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=819B19D53CA6736448F9325A85736792%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0588081AB0E63BA785938467E1B10CCA%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=4DA924CF622D039D58BCE71CDF05D242%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=E7A3A5C377E2D29324093377D7DB1C66%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=E6F9D5152DA699934B30DAAB206471F6%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3AD59991CCF1D67339B319B15A41B35D%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=FFDD59E0318B85A3E480874D9796D872%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0CF479628D7CC1EA25EC7998A92F5051%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=D6D0F80386E1380D05CB78E871BC72B1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=38D9E015591BBFD4929E0D0F47FA0055%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=0E2216679CA6E1094D63322E3412D650%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=11083E75553BAAE21DC89CE8F9A195E4%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=767637C23BB42CD5D7397CF58B0BE688%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=14C4E4C72BA075E9069EE67F39188AD8%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=7D010C6BB6A3726F327F7E239166D127%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=89159BA4DD04E4CE5559F132A9964EB3%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=5834ED4291BDEB928270428EBBAF7604%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=3DE09703C8E79ED2CA3F01074719906B%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=E96A73C7BF33A464C510EDE582318BF2%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=32089B8851BBF8BC2D014E9F37288C83%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=09D278F9DE118EF09163C6140255C690%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=03866661686829d806989e2fc5a72606%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=19584675D94829987952432E018D5056%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=330768A4F172E10ACB6287B87289D83B%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=885C99CCFBE77D1CBFCB9C4E7C1A3313%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=22A22BC9E4E0D2F189F1EA01748816AC%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=7FA30E6BB7E8E8A69155636E50BF1B28%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=96DF3A3731912449521F6F8D183279B1%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=7E6CF3FF4576581271AC8A313B2AAB46%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=51791678F351C03A0EB4E2A7B05C6E17%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=25CE42B079282632708FC846129E98A5%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=021BCCA20BA3381B11BDDE26B4E62F20%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=59223B5F52D8799D38E0754855CBDF42%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=81E75D8F1D276C156653D3D8813E4A43%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=17244E8B6B8227E57FE709CCAD421420%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=5B76DA3ACDEDC8A5CDF23A798B5936B4%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=CB2B65BB77D995CC1C0E5DF1C860133C%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=40445337761D80CF465136FAFB1F63E6%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=8A790F401B29FA87BC1E56F7272B3AA6%' ESCAPE '\\' OR Hashes LIKE '%IMPHASH=B50199E952C875241B9CE06C971CE3C1%' ESCAPE '\\'))"
  ],
  "rule_level": "critical",
  "tags": [
    "attack.credential-access",
    "attack.resource-development",
    "attack.t1588.002",
    "attack.t1003"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "PPLdump.exe  -v lsass lsass.dmp",
      "Company": "?",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "c:\\Users\\IEUser\\Desktop\\",
      "Description": "?",
      "EventID": 1,
      "EventRecordID": 564589,
      "FileVersion": "?",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=F1C0C54AA13037F46F55B721F7E2A2349A30DBCF,MD5=DBCA6A3860A106333FF6BE6306B2B186,SHA256=68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41,IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74",
      "IMPHASH": "C547F2E66061A8DFFB6F5A3FF63C0A74",
      "Image": "C:\\Users\\IEUser\\Desktop\\PPLdump.exe",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-EFC5-6081-0000-00203ACE0B00",
      "LogonId": "0xbce3a",
      "MD5": "DBCA6A3860A106333FF6BE6306B2B186",
      "Opcode": 0,
      "OriginalFileName": "?",
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "747F3D96-F040-6081-0000-001046AC1B00",
      "ParentProcessId": 4864,
      "ProcessGuid": "747F3D96-F415-6081-0000-001040FE4900",
      "ProcessID": 3352,
      "Product": "?",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "F1C0C54AA13037F46F55B721F7E2A2349A30DBCF",
      "SHA256": "68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41",
      "SystemTime": "2021-04-22T22:09:25.389633Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4696,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:25.377",
      "Version": 5
    }
  ]
},
{
  "title": "LSASS Dump Keyword In CommandLine",
  "id": "ffa6861c-4461-4f59-8a41-578c39f3f23e",
  "description": "Detects the presence of the keywords \"lsass\" and \".dmp\" in the commandline, which could indicate a potential attempt to dump or create a dump of the lsass process.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((CommandLine LIKE '%lsass.dmp%' ESCAPE '\\' OR CommandLine LIKE '%lsass.zip%' ESCAPE '\\' OR CommandLine LIKE '%lsass.rar%' ESCAPE '\\' OR CommandLine LIKE '%Andrew.dmp%' ESCAPE '\\' OR CommandLine LIKE '%Coredump.dmp%' ESCAPE '\\' OR CommandLine LIKE '%NotLSASS.zip%' ESCAPE '\\' OR CommandLine LIKE '%lsass\\_2%' ESCAPE '\\' OR CommandLine LIKE '%lsassdump%' ESCAPE '\\' OR CommandLine LIKE '%lsassdmp%' ESCAPE '\\') OR (CommandLine LIKE '%lsass%' ESCAPE '\\' AND CommandLine LIKE '%.dmp%' ESCAPE '\\') OR (CommandLine LIKE '%SQLDmpr%' ESCAPE '\\' AND CommandLine LIKE '%.mdmp%' ESCAPE '\\') OR (CommandLine LIKE '%nanodump%' ESCAPE '\\' AND CommandLine LIKE '%.dmp%' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "PPLdump.exe  -v lsass lsass.dmp",
      "Company": "?",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "c:\\Users\\IEUser\\Desktop\\",
      "Description": "?",
      "EventID": 1,
      "EventRecordID": 564589,
      "FileVersion": "?",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=F1C0C54AA13037F46F55B721F7E2A2349A30DBCF,MD5=DBCA6A3860A106333FF6BE6306B2B186,SHA256=68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41,IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74",
      "IMPHASH": "C547F2E66061A8DFFB6F5A3FF63C0A74",
      "Image": "C:\\Users\\IEUser\\Desktop\\PPLdump.exe",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-EFC5-6081-0000-00203ACE0B00",
      "LogonId": "0xbce3a",
      "MD5": "DBCA6A3860A106333FF6BE6306B2B186",
      "Opcode": 0,
      "OriginalFileName": "?",
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "747F3D96-F040-6081-0000-001046AC1B00",
      "ParentProcessId": 4864,
      "ProcessGuid": "747F3D96-F415-6081-0000-001040FE4900",
      "ProcessID": 3352,
      "Product": "?",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "F1C0C54AA13037F46F55B721F7E2A2349A30DBCF",
      "SHA256": "68612B1C72B8AA498530ACEB929ED44F1837B8BC52D1269E30A834931434FC41",
      "SystemTime": "2021-04-22T22:09:25.389633Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4696,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:25.377",
      "Version": 5
    },
    {
      "row_id": 5,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\services.exe 652 \"lsass.dmp\" a708b1d9-e27b-48bc-8ea7-c56d3a23f99 -v",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "c:\\Users\\IEUser\\Desktop\\",
      "Description": "Services and Controller app",
      "EventID": 1,
      "EventRecordID": 564593,
      "FileVersion": "10.0.17763.1075 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=617A0A0BAAB180541DB739C4A6851D784943C317,MD5=DB896369FB58241ADF28515E3765C514,SHA256=A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC,IMPHASH=7D2820FC8CAF521DC2058168B480D204",
      "IMPHASH": "7D2820FC8CAF521DC2058168B480D204",
      "Image": "C:\\Windows\\System32\\services.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-6E19-6082-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "DB896369FB58241ADF28515E3765C514",
      "Opcode": 0,
      "OriginalFileName": "services.exe",
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ParentCommandLine": "PPLdump.exe  -v lsass lsass.dmp",
      "ParentImage": "C:\\Users\\IEUser\\Desktop\\PPLdump.exe",
      "ParentProcessGuid": "747F3D96-F415-6081-0000-001040FE4900",
      "ParentProcessId": 6316,
      "ProcessGuid": "747F3D96-F416-6081-0000-001033034A00",
      "ProcessID": 3352,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "617A0A0BAAB180541DB739C4A6851D784943C317",
      "SHA256": "A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC",
      "SystemTime": "2021-04-22T22:09:26.081337Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4696,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:26.016",
      "Version": 5
    }
  ]
},
{
  "title": "RunMRU Registry Key Deletion - Registry",
  "id": "3a9b8c1e-5b2e-4f7a-9d1c-2a7f3b6e1c55",
  "description": "Detects attempts to delete the RunMRU registry key, which stores the history of commands executed via the run dialog.\nIn the clickfix techniques, the phishing lures instruct users to open a run dialog through (Win + R) and execute malicious commands.\nAdversaries may delete this key to cover their tracks after executing commands.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=12 AND TargetObject LIKE '%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\RunMRU' ESCAPE '\\')"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.t1070.003"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 14,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "EventID": 12,
      "EventRecordID": 564603,
      "EventType": "CreateKey",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Windows\\system32\\mmc.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ProcessGuid": "747F3D96-F053-6081-0000-0010A90E1D00",
      "ProcessID": 3352,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2021-04-22T22:09:35.165933Z",
      "TargetObject": "HKU\\S-1-5-21-3461203602-4096304019-2269080069-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU",
      "Task": 12,
      "ThreadID": 4696,
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:35.159",
      "Version": 2
    }
  ]
},
{
  "title": "LSASS Process Memory Dump Files",
  "id": "a5a2d357-1ab8-4675-a967-ef9990a59391",
  "description": "Detects creation of files with names used by different memory dumping tools to create a memory dump of the LSASS process memory, which contains user credentials.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=11 AND ((TargetFilename LIKE '%\\\\Andrew.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\Coredump.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsass.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsass.rar' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsass.zip' ESCAPE '\\' OR TargetFilename LIKE '%\\\\NotLSASS.zip' ESCAPE '\\' OR TargetFilename LIKE '%\\\\PPLBlade.dmp' ESCAPE '\\' OR TargetFilename LIKE '%\\\\rustive.dmp' ESCAPE '\\') OR (TargetFilename LIKE '%\\\\lsass\\_2%' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsassdmp%' ESCAPE '\\' OR TargetFilename LIKE '%\\\\lsassdump%' ESCAPE '\\') OR (TargetFilename LIKE '%\\\\lsass%' ESCAPE '\\' AND TargetFilename LIKE '%.dmp%' ESCAPE '\\') OR (TargetFilename LIKE '%SQLDmpr%' ESCAPE '\\' AND TargetFilename LIKE '%.mdmp' ESCAPE '\\') OR ((TargetFilename LIKE '%\\\\nanodump%' ESCAPE '\\' OR TargetFilename LIKE '%\\\\proc\\_%' ESCAPE '\\') AND TargetFilename LIKE '%.dmp' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.credential-access",
    "attack.t1003.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 8,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "CreationUtcTime": "2021-04-22 22:09:26.157",
      "EventID": 11,
      "EventRecordID": 564596,
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Windows\\system32\\services.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ProcessGuid": "747F3D96-F416-6081-0000-001033034A00",
      "ProcessID": 3352,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2021-04-22T22:09:26.163007Z",
      "TargetFileName": "C:\\Users\\IEUser\\Desktop\\lsass.dmp",
      "Task": 11,
      "ThreadID": 4696,
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:26.157",
      "Version": 2
    }
  ]
},
{
  "title": "Uncommon Svchost Parent Process",
  "id": "01d2e2a1-5f09-44f7-9fc1-24faa7479b6d",
  "description": "Detects an uncommon svchost parent process",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE '%\\\\svchost.exe' ESCAPE '\\' AND (NOT ((ParentImage LIKE '%\\\\Mrt.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\MsMpEng.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ngen.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\rpcnet.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\services.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\TiWorker.exe' ESCAPE '\\') OR ParentImage IS NULL OR (ParentImage='-' OR ParentImage='')))))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036.005"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 16,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\svchost.exe -k LocalService -p -s fdPHost",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Host Process for Windows Services",
      "EventID": 1,
      "EventRecordID": 564605,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
      "IMPHASH": "247B9220E5D9B720A82B2C8B5069AD69",
      "Image": "C:\\Windows\\System32\\svchost.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-6E1A-6082-0000-0020E5030000",
      "LogonId": "0x3e5",
      "MD5": "8A0A29438052FAED8A2532DA50455756",
      "Opcode": 0,
      "OriginalFileName": "svchost.exe",
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 624,
      "ProcessGuid": "747F3D96-F41F-6081-0000-001078834A00",
      "ProcessID": 3352,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A1385CE20AD79F55DF235EFFD9780C31442AA234",
      "SHA256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6",
      "SystemTime": "2021-04-22T22:09:35.284225Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4696,
      "User": "NT AUTHORITY\\LOCAL SERVICE",
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:35.263",
      "Version": 5
    }
  ]
},
{
  "title": "Windows Processes Suspicious Parent Directory",
  "id": "96036718-71cc-4027-a538-d1587e0006a7",
  "description": "Detect suspicious parent processes of well-known Windows processes",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\svchost.exe' ESCAPE '\\' OR Image LIKE '%\\\\taskhost.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsm.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsass.exe' ESCAPE '\\' OR Image LIKE '%\\\\services.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsaiso.exe' ESCAPE '\\' OR Image LIKE '%\\\\csrss.exe' ESCAPE '\\' OR Image LIKE '%\\\\wininit.exe' ESCAPE '\\' OR Image LIKE '%\\\\winlogon.exe' ESCAPE '\\') AND (NOT (((ParentImage LIKE '%\\\\SavService.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ngen.exe' ESCAPE '\\') OR (ParentImage LIKE '%\\\\System32\\\\%' ESCAPE '\\' OR ParentImage LIKE '%\\\\SysWOW64\\\\%' ESCAPE '\\')) OR ((ParentImage LIKE '%\\\\Windows Defender\\\\%' ESCAPE '\\' OR ParentImage LIKE '%\\\\Microsoft Security Client\\\\%' ESCAPE '\\') AND ParentImage LIKE '%\\\\MsMpEng.exe' ESCAPE '\\') OR (ParentImage IS NULL OR (ParentImage='' OR ParentImage='-'))))))"
  ],
  "rule_level": "low",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036.003",
    "attack.t1036.005"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 5,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\services.exe 652 \"lsass.dmp\" a708b1d9-e27b-48bc-8ea7-c56d3a23f99 -v",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "c:\\Users\\IEUser\\Desktop\\",
      "Description": "Services and Controller app",
      "EventID": 1,
      "EventRecordID": 564593,
      "FileVersion": "10.0.17763.1075 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=617A0A0BAAB180541DB739C4A6851D784943C317,MD5=DB896369FB58241ADF28515E3765C514,SHA256=A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC,IMPHASH=7D2820FC8CAF521DC2058168B480D204",
      "IMPHASH": "7D2820FC8CAF521DC2058168B480D204",
      "Image": "C:\\Windows\\System32\\services.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-6E19-6082-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "DB896369FB58241ADF28515E3765C514",
      "Opcode": 0,
      "OriginalFileName": "services.exe",
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ParentCommandLine": "PPLdump.exe  -v lsass lsass.dmp",
      "ParentImage": "C:\\Users\\IEUser\\Desktop\\PPLdump.exe",
      "ParentProcessGuid": "747F3D96-F415-6081-0000-001040FE4900",
      "ParentProcessId": 6316,
      "ProcessGuid": "747F3D96-F416-6081-0000-001033034A00",
      "ProcessID": 3352,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "617A0A0BAAB180541DB739C4A6851D784943C317",
      "SHA256": "A2E369DF26C88015FE1F97C7542D6023B5B1E4830C25F94819507EE5BCB1DFCC",
      "SystemTime": "2021-04-22T22:09:26.081337Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4696,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:26.016",
      "Version": 5
    },
    {
      "row_id": 16,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\svchost.exe -k LocalService -p -s fdPHost",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Host Process for Windows Services",
      "EventID": 1,
      "EventRecordID": 564605,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
      "IMPHASH": "247B9220E5D9B720A82B2C8B5069AD69",
      "Image": "C:\\Windows\\System32\\svchost.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-6E1A-6082-0000-0020E5030000",
      "LogonId": "0x3e5",
      "MD5": "8A0A29438052FAED8A2532DA50455756",
      "Opcode": 0,
      "OriginalFileName": "svchost.exe",
      "OriginalLogfile": "ppl_bypass_ppldump_knowdll_hijack_sysmon_security.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 624,
      "ProcessGuid": "747F3D96-F41F-6081-0000-001078834A00",
      "ProcessID": 3352,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A1385CE20AD79F55DF235EFFD9780C31442AA234",
      "SHA256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6",
      "SystemTime": "2021-04-22T22:09:35.284225Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4696,
      "User": "NT AUTHORITY\\LOCAL SERVICE",
      "UserID": "S-1-5-18",
      "UtcTime": "2021-04-22 22:09:35.263",
      "Version": 5
    }
  ]
}]