[{
  "title": "Unusual Parent Process For Cmd.EXE",
  "id": "4b991083-3d0e-44ce-8fc4-b254025d8d4b",
  "description": "Detects suspicious parent process for cmd.exe",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE '%\\\\cmd.exe' ESCAPE '\\' AND (ParentImage LIKE '%\\\\csrss.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ctfmon.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\dllhost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\epad.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\FlashPlayerUpdateService.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\GoogleUpdate.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\jucheck.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\jusched.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\LogonUI.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\lsass.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\regsvr32.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\SearchIndexer.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\SearchProtocolHost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\SIHClient.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\sihost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\slui.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\spoolsv.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\sppsvc.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\taskhostw.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\unsecapp.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\WerFault.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\wermgr.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\wlanext.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\WUDFHost.exe' ESCAPE '\\')))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.execution",
    "attack.t1059"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 8,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 5407,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-D4E9-5D45-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalLogfile": "Sysmon_UACME_30.evtx",
      "ParentCommandLine": "C:\\Windows\\SysWOW64\\WerFault.exe -pss -s 444 -p 6312 -ip 6312",
      "ParentImage": "C:\\Windows\\SysWOW64\\WerFault.exe",
      "ParentProcessGuid": "747F3D96-6EA5-5D45-0000-00107AC9E100",
      "ParentProcessId": 932,
      "ProcessGuid": "747F3D96-6EA5-5D45-0000-001032CCE100",
      "ProcessID": 2780,
      "Product": "Microsoft速 Windows速 Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2019-08-03T11:23:18.694577Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 3676,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2019-08-03 11:23:17.636",
      "Version": 5
    },
    {
      "row_id": 11,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 5410,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-D4E9-5D45-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalLogfile": "Sysmon_UACME_30.evtx",
      "ParentCommandLine": "C:\\Windows\\SysWOW64\\WerFault.exe -pss -s 512 -p 4348 -ip 4348",
      "ParentImage": "C:\\Windows\\SysWOW64\\WerFault.exe",
      "ParentProcessGuid": "747F3D96-6EA5-5D45-0000-0010EED0E100",
      "ParentProcessId": 4768,
      "ProcessGuid": "747F3D96-6EA5-5D45-0000-00108FD3E100",
      "ProcessID": 2780,
      "Product": "Microsoft速 Windows速 Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2019-08-03T11:23:18.824713Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 3676,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2019-08-03 11:23:17.702",
      "Version": 5
    }
  ]
}]