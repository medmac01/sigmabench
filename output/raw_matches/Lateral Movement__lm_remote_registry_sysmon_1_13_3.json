[{
  "title": "Uncommon Svchost Parent Process",
  "id": "01d2e2a1-5f09-44f7-9fc1-24faa7479b6d",
  "description": "Detects an uncommon svchost parent process",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE '%\\\\svchost.exe' ESCAPE '\\' AND (NOT ((ParentImage LIKE '%\\\\Mrt.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\MsMpEng.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ngen.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\rpcnet.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\services.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\TiWorker.exe' ESCAPE '\\') OR ParentImage IS NULL OR (ParentImage='-' OR ParentImage='')))))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036.005"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\svchost.exe -k localService -p -s RemoteRegistry",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Host Process for Windows Services",
      "EventID": 1,
      "EventRecordID": 549016,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
      "IMPHASH": "247B9220E5D9B720A82B2C8B5069AD69",
      "Image": "C:\\Windows\\System32\\svchost.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-3407-5FCB-0000-0020E5030000",
      "LogonId": "0x3e5",
      "MD5": "8A0A29438052FAED8A2532DA50455756",
      "Opcode": 0,
      "OriginalFileName": "svchost.exe",
      "OriginalLogfile": "lm_remote_registry_sysmon_1_13_3.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 612,
      "ProcessGuid": "747F3D96-BB00-5FCA-0000-001033CD7600",
      "ProcessID": 3560,
      "Product": "Microsoft速 Windows速 Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A1385CE20AD79F55DF235EFFD9780C31442AA234",
      "SHA256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6",
      "SystemTime": "2020-12-04T22:41:04.470207Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4600,
      "User": "NT AUTHORITY\\LOCAL SERVICE",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-04 22:41:04.465",
      "Version": 5
    }
  ]
},
{
  "title": "CurrentVersion Autorun Keys Modification",
  "id": "20f0ee37-5942-4e45-b7d5-c5b5db9df5cd",
  "description": "Detects modification of autostart extensibility point (ASEP) in registry.",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=13 AND ((TargetObject LIKE '%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion%' ESCAPE '\\' AND (TargetObject LIKE '%\\\\ShellServiceObjectDelayLoad%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Run\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\RunOnce\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\RunOnceEx\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\RunServices\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\RunServicesOnce\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Policies\\\\System\\\\Shell%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Policies\\\\Explorer\\\\Run%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Group Policy\\\\Scripts\\\\Startup%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Group Policy\\\\Scripts\\\\Shutdown%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Group Policy\\\\Scripts\\\\Logon%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Group Policy\\\\Scripts\\\\Logoff%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Explorer\\\\ShellServiceObjects%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Explorer\\\\ShellIconOverlayIdentifiers%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Explorer\\\\ShellExecuteHooks%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Explorer\\\\SharedTaskScheduler%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Explorer\\\\Browser Helper Objects%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Authentication\\\\PLAP Providers%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Authentication\\\\Credential Providers%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Authentication\\\\Credential Provider Filters%' ESCAPE '\\')) AND (NOT ((Details='(Empty)' OR TargetObject LIKE '%\\\\NgcFirst\\\\ConsecutiveSwitchCount' ESCAPE '\\' OR (Image LIKE '%\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE '%\\\\AppData\\\\Roaming\\\\Spotify\\\\Spotify.exe' ESCAPE '\\' OR Image LIKE '%\\\\AppData\\\\Local\\\\WebEx\\\\WebexHost.exe' ESCAPE '\\') OR (Image LIKE 'C:\\\\WINDOWS\\\\system32\\\\devicecensus.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Windows\\\\system32\\\\winsat.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files\\\\Microsoft OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files\\\\Microsoft OneDrive\\\\Update\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft OneDrive\\\\Update\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\integration\\\\Addons\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\Addons\\\\OneDriveSetup.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files\\\\KeePass Password Safe 2\\\\ShInstUtil.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files\\\\Everything\\\\Everything.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe' ESCAPE '\\')) OR Details IS NULL OR (Image LIKE 'C:\\\\Windows\\\\system32\\\\LogonUI.exe' ESCAPE '\\' AND (TargetObject LIKE '%\\\\Authentication\\\\Credential Providers\\\\{D6886603-9D2F-4EB2-B667-1971041FA96B}\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Authentication\\\\Credential Providers\\\\{BEC09223-B018-416D-A0AC-523971B639F5}\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Authentication\\\\Credential Providers\\\\{8AF662BF-65A0-4D0A-A540-A338A999D36F}\\\\%' ESCAPE '\\' OR TargetObject LIKE '%\\\\Authentication\\\\Credential Providers\\\\{27FBDB57-B613-4AF2-9D7E-4FA7A66C21AD}\\\\%' ESCAPE '\\')) OR (Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\%' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\%' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe%' ESCAPE '\\') OR Image LIKE 'C:\\\\Program Files\\\\Windows Defender\\\\MsMpEng.exe' ESCAPE '\\' OR (Image LIKE '%\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe' ESCAPE '\\' AND Details LIKE '%\\\\Microsoft\\\\Teams\\\\Update.exe --processStart %' ESCAPE '\\') OR (Image LIKE 'C:\\\\Windows\\\\system32\\\\userinit.exe' ESCAPE '\\' AND Details='ctfmon.exe /n'))) AND (NOT ((Image LIKE 'C:\\\\Windows\\\\system32\\\\regsvr32.exe' ESCAPE '\\' AND TargetObject LIKE '%DropboxExt%' ESCAPE '\\' AND Details LIKE '%A251-47B7-93E1-CDD82E34AF8B}' ESCAPE '\\') OR (TargetObject LIKE '%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera Browser Assistant' ESCAPE '\\' AND Details LIKE 'C:\\\\Program Files\\\\Opera\\\\assistant\\\\browser\\_assistant.exe' ESCAPE '\\') OR (TargetObject LIKE '%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera Stable' ESCAPE '\\' AND (Details LIKE 'C:\\\\Program Files\\\\Opera\\\\launcher.exe' ESCAPE '\\' OR Details LIKE 'C:\\\\Program Files (x86)\\\\Opera\\\\launcher.exe' ESCAPE '\\')) OR (TargetObject LIKE '%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\iTunesHelper' ESCAPE '\\' AND Details LIKE '\"C:\\\\Program Files\\\\iTunes\\\\iTunesHelper.exe\"' ESCAPE '\\') OR (TargetObject LIKE '%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\zoommsirepair' ESCAPE '\\' AND Details LIKE '\"C:\\\\Program Files\\\\Zoom\\\\bin\\\\installer.exe\" /repair' ESCAPE '\\') OR (TargetObject LIKE '%\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Greenshot' ESCAPE '\\' AND Details LIKE 'C:\\\\Program Files\\\\Greenshot\\\\Greenshot.exe' ESCAPE '\\') OR (TargetObject LIKE '%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\GoogleDriveFS' ESCAPE '\\' AND Details LIKE 'C:\\\\Program Files\\\\Google\\\\Drive File Stream\\\\%' ESCAPE '\\' AND Details LIKE '%\\\\GoogleDriveFS.exe%' ESCAPE '\\') OR (TargetObject LIKE '%GoogleDrive%' ESCAPE '\\' AND (Details='{CFE8B367-77A7-41D7-9C90-75D16D7DC6B6}' OR Details='{A8E52322-8734-481D-A7E2-27B309EF8D56}' OR Details='{C973DA94-CBDF-4E77-81D1-E5B794FBD146}' OR Details='{51EF1569-67EE-4AD6-9646-E726C3FFC8A2}')) OR ((Details LIKE 'C:\\\\Windows\\\\system32\\\\cmd.exe /q /c rmdir /s /q \"C:\\\\Users\\\\%' ESCAPE '\\' OR Details LIKE 'C:\\\\Windows\\\\system32\\\\cmd.exe /q /c del /q \"C:\\\\Users\\\\%' ESCAPE '\\') AND Details LIKE '%\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\%' ESCAPE '\\') OR (TargetObject LIKE '%\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{%' ESCAPE '\\' AND (Details LIKE '%\\\\AppData\\\\Local\\\\Package Cache\\\\{%' ESCAPE '\\' AND Details LIKE '%}\\\\python-%' ESCAPE '\\') AND Details LIKE '%.exe\" /burn.runonce' ESCAPE '\\') OR ((Image LIKE 'C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\%' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\%' ESCAPE '\\') AND Image LIKE '%\\\\OfficeClickToRun.exe' ESCAPE '\\') OR (Image LIKE '%\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe' ESCAPE '\\' AND Details LIKE '%\\\\Microsoft\\\\Teams\\\\Update.exe --processStart%' ESCAPE '\\') OR ((Image LIKE '%C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\Setup\\\\%' ESCAPE '\\' OR Image LIKE '%C:\\\\Program Files (x86)\\\\AVG\\\\Antivirus\\\\Setup\\\\%' ESCAPE '\\' OR Image LIKE '%\\\\instup.exe%' ESCAPE '\\') AND (Details LIKE '\"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\" /gui' ESCAPE '\\' OR Details LIKE '\"C:\\\\Program Files (x86)\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\" /gui' ESCAPE '\\' OR Details='{472083B0-C522-11CF-8763-00608CC02F24}' OR Details='{472083B1-C522-11CF-8763-00608CC02F24}')) OR ((Image LIKE '%C:\\\\Program Files\\\\Avast Software\\\\Avast\\\\Setup\\\\%' ESCAPE '\\' OR Image LIKE '%C:\\\\Program Files (x86)\\\\Avast Software\\\\Avast\\\\Setup\\\\%' ESCAPE '\\' OR Image LIKE '%\\\\instup.exe%' ESCAPE '\\') AND (Details LIKE '\"C:\\\\Program Files\\\\Avast Software\\\\Avast\\\\AvLaunch.exe\" /gui' ESCAPE '\\' OR Details LIKE '\"C:\\\\Program Files (x86)\\\\Avast Software\\\\Avast\\\\AvLaunch.exe\" /gui' ESCAPE '\\')) OR ((Image LIKE 'C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\avgToolsSvc.exe' ESCAPE '\\' OR Image LIKE 'C:\\\\Program Files (x86)\\\\AVG\\\\Antivirus\\\\avgToolsSvc.exe' ESCAPE '\\') AND TargetObject LIKE '%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\StartupApproved\\\\Run\\\\%' ESCAPE '\\' AND Details='Binary Data') OR ((Image LIKE '%\\\\aurora-agent-64.exe' ESCAPE '\\' OR Image LIKE '%\\\\aurora-agent.exe' ESCAPE '\\') AND TargetObject LIKE '%\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\aurora-dashboard' ESCAPE '\\' AND Details LIKE 'C:\\\\Program Files\\\\Aurora-Agent\\\\tools\\\\aurora-dashboard.exe' ESCAPE '\\') OR (TargetObject LIKE '%\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Everything' ESCAPE '\\' AND Details LIKE '%\\\\Everything\\\\Everything.exe\" -startup' ESCAPE '\\') OR (TargetObject LIKE '%\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Discord' ESCAPE '\\' AND Details LIKE '%\\\\Discord\\\\Update.exe --processStart Discord.exe' ESCAPE '\\')))))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.privilege-escalation",
    "attack.persistence",
    "attack.t1547.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 3,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "Details": "C:\\Windows\\System32\\Rundll32.exe smssvc.dll,Start",
      "EventID": 13,
      "EventRecordID": 549018,
      "EventType": "SetValue",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Windows\\system32\\svchost.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "lm_remote_registry_sysmon_1_13_3.evtx",
      "ProcessGuid": "747F3D96-BB00-5FCA-0000-001033CD7600",
      "ProcessID": 3560,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2020-12-04T22:41:04.545145Z",
      "TargetObject": "HKU\\S-1-5-21-3461203602-4096304019-2269080069-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\SUpdate",
      "Task": 13,
      "ThreadID": 4600,
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-04 22:41:04.544",
      "Version": 2
    }
  ]
},
{
  "title": "Windows Processes Suspicious Parent Directory",
  "id": "96036718-71cc-4027-a538-d1587e0006a7",
  "description": "Detect suspicious parent processes of well-known Windows processes",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\svchost.exe' ESCAPE '\\' OR Image LIKE '%\\\\taskhost.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsm.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsass.exe' ESCAPE '\\' OR Image LIKE '%\\\\services.exe' ESCAPE '\\' OR Image LIKE '%\\\\lsaiso.exe' ESCAPE '\\' OR Image LIKE '%\\\\csrss.exe' ESCAPE '\\' OR Image LIKE '%\\\\wininit.exe' ESCAPE '\\' OR Image LIKE '%\\\\winlogon.exe' ESCAPE '\\') AND (NOT (((ParentImage LIKE '%\\\\SavService.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ngen.exe' ESCAPE '\\') OR (ParentImage LIKE '%\\\\System32\\\\%' ESCAPE '\\' OR ParentImage LIKE '%\\\\SysWOW64\\\\%' ESCAPE '\\')) OR ((ParentImage LIKE '%\\\\Windows Defender\\\\%' ESCAPE '\\' OR ParentImage LIKE '%\\\\Microsoft Security Client\\\\%' ESCAPE '\\') AND ParentImage LIKE '%\\\\MsMpEng.exe' ESCAPE '\\') OR (ParentImage IS NULL OR (ParentImage='' OR ParentImage='-'))))))"
  ],
  "rule_level": "low",
  "tags": [
    "attack.defense-evasion",
    "attack.t1036.003",
    "attack.t1036.005"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\svchost.exe -k localService -p -s RemoteRegistry",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Host Process for Windows Services",
      "EventID": 1,
      "EventRecordID": 549016,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A1385CE20AD79F55DF235EFFD9780C31442AA234,MD5=8A0A29438052FAED8A2532DA50455756,SHA256=7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6,IMPHASH=247B9220E5D9B720A82B2C8B5069AD69",
      "IMPHASH": "247B9220E5D9B720A82B2C8B5069AD69",
      "Image": "C:\\Windows\\System32\\svchost.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-3407-5FCB-0000-0020E5030000",
      "LogonId": "0x3e5",
      "MD5": "8A0A29438052FAED8A2532DA50455756",
      "Opcode": 0,
      "OriginalFileName": "svchost.exe",
      "OriginalLogfile": "lm_remote_registry_sysmon_1_13_3.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 612,
      "ProcessGuid": "747F3D96-BB00-5FCA-0000-001033CD7600",
      "ProcessID": 3560,
      "Product": "Microsoft速 Windows速 Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A1385CE20AD79F55DF235EFFD9780C31442AA234",
      "SHA256": "7FD065BAC18C5278777AE44908101CDFED72D26FA741367F0AD4D02020787AB6",
      "SystemTime": "2020-12-04T22:41:04.470207Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4600,
      "User": "NT AUTHORITY\\LOCAL SERVICE",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-04 22:41:04.465",
      "Version": 5
    }
  ]
}]