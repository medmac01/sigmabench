[{
  "title": "Whoami.EXE Execution From Privileged Process",
  "id": "79ce34ca-af29-4d0e-b832-fc1b377020db",
  "description": "Detects the execution of \"whoami.exe\" by privileged accounts that are often abused by threat actors",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((OriginalFileName='whoami.exe' OR Image LIKE '%\\\\whoami.exe' ESCAPE '\\') AND (User LIKE '%AUTHORI%' ESCAPE '\\' OR User LIKE '%AUTORI%' ESCAPE '\\' OR User LIKE '%TrustedInstaller%' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.privilege-escalation",
    "attack.discovery",
    "attack.t1033"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 37,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "whoami",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "whoami - displays logged on user information",
      "EventID": 1,
      "EventRecordID": 342417,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=47D7864D26FC67E0D60391CBF170D33DA518C322,MD5=43C2D3293AD939241DF61B3630A9D3B6,SHA256=1D5491E3C468EE4B4EF6EDFF4BBC7D06EE83180F6F0B1576763EA2EFE049493A,IMPHASH=7FF0758B766F747CE57DFAC70743FB88",
      "IMPHASH": "7FF0758B766F747CE57DFAC70743FB88",
      "Image": "C:\\Windows\\System32\\whoami.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E909-5F33-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "43C2D3293AD939241DF61B3630A9D3B6",
      "Opcode": 0,
      "OriginalFileName": "whoami.exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "747F3D96-E93C-5F33-0000-0010A6F00E00",
      "ParentProcessId": 8032,
      "ProcessGuid": "747F3D96-E940-5F33-0000-001039310F00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "47D7864D26FC67E0D60391CBF170D33DA518C322",
      "SHA256": "1D5491E3C468EE4B4EF6EDFF4BBC7D06EE83180F6F0B1576763EA2EFE049493A",
      "SystemTime": "2020-08-12T13:06:08.143703Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4176,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:08.141",
      "Version": 5
    }
  ]
},
{
  "title": "Abused Debug Privilege by Arbitrary Parent Processes",
  "id": "d522eca2-2973-4391-a3e0-ef0374321dae",
  "description": "Detection of unusual child processes by different system processes",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((((ParentImage LIKE '%\\\\winlogon.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\services.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\lsass.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\csrss.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\smss.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\wininit.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\spoolsv.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\searchindexer.exe' ESCAPE '\\') AND (User LIKE '%AUTHORI%' ESCAPE '\\' OR User LIKE '%AUTORI%' ESCAPE '\\')) AND ((Image LIKE '%\\\\powershell.exe' ESCAPE '\\' OR Image LIKE '%\\\\pwsh.exe' ESCAPE '\\' OR Image LIKE '%\\\\cmd.exe' ESCAPE '\\') OR (OriginalFileName='PowerShell.EXE' OR OriginalFileName='pwsh.dll' OR OriginalFileName='Cmd.Exe'))) AND (NOT (CommandLine LIKE '% route %' ESCAPE '\\' AND CommandLine LIKE '% ADD %' ESCAPE '\\'))))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.privilege-escalation",
    "attack.t1548"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 27,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "cmd.exe",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342407,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E909-5F33-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\services.exe",
      "ParentImage": "C:\\Windows\\System32\\services.exe",
      "ParentProcessGuid": "747F3D96-E909-5F33-0000-00108C580000",
      "ParentProcessId": 612,
      "ProcessGuid": "747F3D96-E90C-5F33-0000-0010CB420200",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:05:20.378005Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4176,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:05:16.721",
      "Version": 5
    }
  ]
},
{
  "title": "Potentially Suspicious Execution From Parent Process In Public Folder",
  "id": "69bd9b97-2be2-41b6-9816-fb08757a4d1a",
  "description": "Detects a potentially suspicious execution of a parent process located in the \"\\Users\\Public\" folder executing a child process containing references to shell or scripting binaries and commandlines.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (ParentImage LIKE '%:\\\\Users\\\\Public\\\\%' ESCAPE '\\' AND ((Image LIKE '%\\\\bitsadmin.exe' ESCAPE '\\' OR Image LIKE '%\\\\certutil.exe' ESCAPE '\\' OR Image LIKE '%\\\\cmd.exe' ESCAPE '\\' OR Image LIKE '%\\\\cscript.exe' ESCAPE '\\' OR Image LIKE '%\\\\mshta.exe' ESCAPE '\\' OR Image LIKE '%\\\\powershell.exe' ESCAPE '\\' OR Image LIKE '%\\\\pwsh.exe' ESCAPE '\\' OR Image LIKE '%\\\\regsvr32.exe' ESCAPE '\\' OR Image LIKE '%\\\\rundll32.exe' ESCAPE '\\' OR Image LIKE '%\\\\wscript.exe' ESCAPE '\\') OR (CommandLine LIKE '%bitsadmin%' ESCAPE '\\' OR CommandLine LIKE '%certutil%' ESCAPE '\\' OR CommandLine LIKE '%cscript%' ESCAPE '\\' OR CommandLine LIKE '%mshta%' ESCAPE '\\' OR CommandLine LIKE '%powershell%' ESCAPE '\\' OR CommandLine LIKE '%regsvr32%' ESCAPE '\\' OR CommandLine LIKE '%rundll32%' ESCAPE '\\' OR CommandLine LIKE '%wscript%' ESCAPE '\\'))))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.execution",
    "attack.t1564",
    "attack.t1059"
  ],
  "count": 4,
  "matches": [
    {
      "row_id": 31,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\cmd.exe /c rmdir /s/q C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\a_b_c_d_e > nul 2>&1",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342411,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E911-5F33-0000-0020241C0400",
      "LogonId": "0x41c24",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "WerTrigger.exe",
      "ParentImage": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\WerTrigger.exe",
      "ParentProcessGuid": "747F3D96-E938-5F33-0000-00109CA00E00",
      "ParentProcessId": 7820,
      "ProcessGuid": "747F3D96-E938-5F33-0000-00101CA50E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:00.737148Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4176,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:00.734",
      "Version": 5
    },
    {
      "row_id": 32,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\cmd.exe /c mkdir,C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\a_b_c_d_e",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342412,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E911-5F33-0000-0020241C0400",
      "LogonId": "0x41c24",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "WerTrigger.exe",
      "ParentImage": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\WerTrigger.exe",
      "ParentProcessGuid": "747F3D96-E938-5F33-0000-00109CA00E00",
      "ParentProcessId": 7820,
      "ProcessGuid": "747F3D96-E939-5F33-0000-0010ACAB0E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:01.637860Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4176,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:01.636",
      "Version": 5
    },
    {
      "row_id": 33,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\cmd.exe /c copy Report.wer C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\a_b_c_d_e > nul 2>&1",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342413,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E911-5F33-0000-0020241C0400",
      "LogonId": "0x41c24",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "WerTrigger.exe",
      "ParentImage": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\WerTrigger.exe",
      "ParentProcessGuid": "747F3D96-E938-5F33-0000-00109CA00E00",
      "ParentProcessId": 7820,
      "ProcessGuid": "747F3D96-E93A-5F33-0000-001014B30E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:02.552084Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4176,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:02.548",
      "Version": 5
    },
    {
      "row_id": 34,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\cmd.exe /c schtasks /run /TN \"Microsoft\\Windows\\Windows Error Reporting\\QueueReporting\" > nul 2>&1",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342414,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E911-5F33-0000-0020241C0400",
      "LogonId": "0x41c24",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "WerTrigger.exe",
      "ParentImage": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\WerTrigger.exe",
      "ParentProcessGuid": "747F3D96-E938-5F33-0000-00109CA00E00",
      "ParentProcessId": 7820,
      "ProcessGuid": "747F3D96-E93B-5F33-0000-0010C1B40E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:03.487498Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4176,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:03.484",
      "Version": 5
    }
  ]
},
{
  "title": "Suspicious Child Process Of Wermgr.EXE",
  "id": "396f6630-f3ac-44e3-bfc8-1b161bc00c4e",
  "description": "Detects suspicious Windows Error Reporting manager (wermgr.exe) child process",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((ParentImage LIKE '%\\\\wermgr.exe' ESCAPE '\\' AND (Image LIKE '%\\\\cmd.exe' ESCAPE '\\' OR Image LIKE '%\\\\cscript.exe' ESCAPE '\\' OR Image LIKE '%\\\\ipconfig.exe' ESCAPE '\\' OR Image LIKE '%\\\\mshta.exe' ESCAPE '\\' OR Image LIKE '%\\\\net.exe' ESCAPE '\\' OR Image LIKE '%\\\\net1.exe' ESCAPE '\\' OR Image LIKE '%\\\\netstat.exe' ESCAPE '\\' OR Image LIKE '%\\\\nslookup.exe' ESCAPE '\\' OR Image LIKE '%\\\\powershell\\_ise.exe' ESCAPE '\\' OR Image LIKE '%\\\\powershell.exe' ESCAPE '\\' OR Image LIKE '%\\\\pwsh.exe' ESCAPE '\\' OR Image LIKE '%\\\\regsvr32.exe' ESCAPE '\\' OR Image LIKE '%\\\\rundll32.exe' ESCAPE '\\' OR Image LIKE '%\\\\systeminfo.exe' ESCAPE '\\' OR Image LIKE '%\\\\whoami.exe' ESCAPE '\\' OR Image LIKE '%\\\\wscript.exe' ESCAPE '\\')) AND (NOT (Image LIKE '%\\\\rundll32.exe' ESCAPE '\\' AND (CommandLine LIKE '%C:\\\\Windows\\\\system32\\\\WerConCpl.dll%' ESCAPE '\\' AND CommandLine LIKE '%LaunchErcApp %' ESCAPE '\\') AND (CommandLine LIKE '%-queuereporting%' ESCAPE '\\' OR CommandLine LIKE '%-responsepester%' ESCAPE '\\')))))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.defense-evasion",
    "attack.privilege-escalation",
    "attack.t1055",
    "attack.t1036"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 36,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342416,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E909-5F33-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\wermgr.exe -upload",
      "ParentImage": "C:\\Windows\\System32\\wermgr.exe",
      "ParentProcessGuid": "747F3D96-E93B-5F33-0000-001003BA0E00",
      "ParentProcessId": 7920,
      "ProcessGuid": "747F3D96-E93C-5F33-0000-0010A6F00E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:04.075706Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4176,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:04.074",
      "Version": 5
    }
  ]
},
{
  "title": "Unusual Parent Process For Cmd.EXE",
  "id": "4b991083-3d0e-44ce-8fc4-b254025d8d4b",
  "description": "Detects suspicious parent process for cmd.exe",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE '%\\\\cmd.exe' ESCAPE '\\' AND (ParentImage LIKE '%\\\\csrss.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\ctfmon.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\dllhost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\epad.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\FlashPlayerUpdateService.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\GoogleUpdate.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\jucheck.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\jusched.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\LogonUI.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\lsass.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\regsvr32.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\SearchIndexer.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\SearchProtocolHost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\SIHClient.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\sihost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\slui.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\spoolsv.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\sppsvc.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\taskhostw.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\unsecapp.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\WerFault.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\wermgr.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\wlanext.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\WUDFHost.exe' ESCAPE '\\')))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.execution",
    "attack.t1059"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 36,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342416,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E909-5F33-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\wermgr.exe -upload",
      "ParentImage": "C:\\Windows\\System32\\wermgr.exe",
      "ParentProcessGuid": "747F3D96-E93B-5F33-0000-001003BA0E00",
      "ParentProcessId": 7920,
      "ProcessGuid": "747F3D96-E93C-5F33-0000-0010A6F00E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:04.075706Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4176,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:04.074",
      "Version": 5
    }
  ]
},
{
  "title": "File And SubFolder Enumeration Via Dir Command",
  "id": "7c9340a9-e2ee-4e43-94c5-c54ebbea1006",
  "description": "Detects usage of the \"dir\" command part of Windows CMD with the \"/S\" command line flag in order to enumerate files in a specified directory and all subdirectories.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\cmd.exe' ESCAPE '\\' OR OriginalFileName='Cmd.Exe') AND (CommandLine LIKE '%dir%-s%' ESCAPE '\\' OR CommandLine LIKE '%dir%/s%' ESCAPE '\\' OR CommandLine LIKE '%dir%–s%' ESCAPE '\\' OR CommandLine LIKE '%dir%—s%' ESCAPE '\\' OR CommandLine LIKE '%dir%―s%' ESCAPE '\\')))"
  ],
  "rule_level": "low",
  "tags": [
    "attack.discovery",
    "attack.t1217"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 31,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\cmd.exe /c rmdir /s/q C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\a_b_c_d_e > nul 2>&1",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342411,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E911-5F33-0000-0020241C0400",
      "LogonId": "0x41c24",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "WerTrigger.exe",
      "ParentImage": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\WerTrigger.exe",
      "ParentProcessGuid": "747F3D96-E938-5F33-0000-00109CA00E00",
      "ParentProcessId": 7820,
      "ProcessGuid": "747F3D96-E938-5F33-0000-00101CA50E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:00.737148Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4176,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:00.734",
      "Version": 5
    }
  ]
},
{
  "title": "Directory Removal Via Rmdir",
  "id": "41ca393d-538c-408a-ac27-cf1e038be80c",
  "description": "Detects execution of the builtin \"rmdir\" command in order to delete directories.\nAdversaries may delete files left behind by the actions of their intrusion activity.\nMalware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.\nRemoval of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.\n",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND ((Image LIKE '%\\\\cmd.exe' ESCAPE '\\' OR OriginalFileName='Cmd.Exe') AND CommandLine LIKE '%rmdir%' ESCAPE '\\' AND (CommandLine LIKE '%/s%' ESCAPE '\\' OR CommandLine LIKE '%/q%' ESCAPE '\\')))"
  ],
  "rule_level": "low",
  "tags": [
    "attack.defense-evasion",
    "attack.t1070.004"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 31,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\system32\\cmd.exe /c rmdir /s/q C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\a_b_c_d_e > nul 2>&1",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\",
      "Description": "Windows Command Processor",
      "EventID": 1,
      "EventRecordID": 342411,
      "FileVersion": "10.0.17763.592 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8C5437CD76A89EC983E3B364E219944DA3DAB464,MD5=975B45B669930B0CC773EAF2B414206F,SHA256=3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2,IMPHASH=272245E2988E1E430500B852C4FB5E18",
      "IMPHASH": "272245E2988E1E430500B852C4FB5E18",
      "Image": "C:\\Windows\\System32\\cmd.exe",
      "IntegrityLevel": "Medium",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E911-5F33-0000-0020241C0400",
      "LogonId": "0x41c24",
      "MD5": "975B45B669930B0CC773EAF2B414206F",
      "Opcode": 0,
      "OriginalFileName": "Cmd.Exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "WerTrigger.exe",
      "ParentImage": "C:\\Users\\Public\\tools\\PrivEsc\\cve-2020-1337-poc-master\\WerTrigger.exe",
      "ParentProcessGuid": "747F3D96-E938-5F33-0000-00109CA00E00",
      "ParentProcessId": 7820,
      "ProcessGuid": "747F3D96-E938-5F33-0000-00101CA50E00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8C5437CD76A89EC983E3B364E219944DA3DAB464",
      "SHA256": "3656F37A1C6951EC4496FABB8EE957D3A6E3C276D5A3785476B482C9C0D32EA2",
      "SystemTime": "2020-08-12T13:06:00.737148Z",
      "Task": 1,
      "TerminalSessionId": 1,
      "ThreadID": 4176,
      "User": "MSEDGEWIN10\\IEUser",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:00.734",
      "Version": 5
    }
  ]
},
{
  "title": "Local Accounts Discovery",
  "id": "502b42de-4306-40b4-9596-6f590c81f073",
  "description": "Local accounts, System Owner/User discovery using operating systems utilities",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (((Image LIKE '%\\\\cmd.exe' ESCAPE '\\' AND (CommandLine LIKE '% /c%' ESCAPE '\\' AND CommandLine LIKE '%dir %' ESCAPE '\\' AND CommandLine LIKE '%\\\\Users\\\\%' ESCAPE '\\')) AND (NOT CommandLine LIKE '% rmdir %' ESCAPE '\\')) OR (((Image LIKE '%\\\\net.exe' ESCAPE '\\' OR Image LIKE '%\\\\net1.exe' ESCAPE '\\') AND CommandLine LIKE '%user%' ESCAPE '\\') AND (NOT (CommandLine LIKE '%/domain%' ESCAPE '\\' OR CommandLine LIKE '%/add%' ESCAPE '\\' OR CommandLine LIKE '%/delete%' ESCAPE '\\' OR CommandLine LIKE '%/active%' ESCAPE '\\' OR CommandLine LIKE '%/expires%' ESCAPE '\\' OR CommandLine LIKE '%/passwordreq%' ESCAPE '\\' OR CommandLine LIKE '%/scriptpath%' ESCAPE '\\' OR CommandLine LIKE '%/times%' ESCAPE '\\' OR CommandLine LIKE '%/workstations%' ESCAPE '\\'))) OR (((Image LIKE '%\\\\whoami.exe' ESCAPE '\\' OR Image LIKE '%\\\\quser.exe' ESCAPE '\\' OR Image LIKE '%\\\\qwinsta.exe' ESCAPE '\\') OR (OriginalFileName='whoami.exe' OR OriginalFileName='quser.exe' OR OriginalFileName='qwinsta.exe')) OR (Image LIKE '%\\\\wmic.exe' ESCAPE '\\' AND (CommandLine LIKE '%useraccount%' ESCAPE '\\' AND CommandLine LIKE '%get%' ESCAPE '\\')) OR (Image LIKE '%\\\\cmdkey.exe' ESCAPE '\\' AND CommandLine LIKE '% /l%' ESCAPE '\\'))))"
  ],
  "rule_level": "low",
  "tags": [
    "attack.discovery",
    "attack.t1033",
    "attack.t1087.001"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 37,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "whoami",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "whoami - displays logged on user information",
      "EventID": 1,
      "EventRecordID": 342417,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=47D7864D26FC67E0D60391CBF170D33DA518C322,MD5=43C2D3293AD939241DF61B3630A9D3B6,SHA256=1D5491E3C468EE4B4EF6EDFF4BBC7D06EE83180F6F0B1576763EA2EFE049493A,IMPHASH=7FF0758B766F747CE57DFAC70743FB88",
      "IMPHASH": "7FF0758B766F747CE57DFAC70743FB88",
      "Image": "C:\\Windows\\System32\\whoami.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-E909-5F33-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "43C2D3293AD939241DF61B3630A9D3B6",
      "Opcode": 0,
      "OriginalFileName": "whoami.exe",
      "OriginalLogfile": "privesc_spoolsv_spl_file_write_sysmon11.evtx",
      "ParentCommandLine": "\"C:\\Windows\\system32\\cmd.exe\"",
      "ParentImage": "C:\\Windows\\System32\\cmd.exe",
      "ParentProcessGuid": "747F3D96-E93C-5F33-0000-0010A6F00E00",
      "ParentProcessId": 8032,
      "ProcessGuid": "747F3D96-E940-5F33-0000-001039310F00",
      "ProcessID": 3344,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "47D7864D26FC67E0D60391CBF170D33DA518C322",
      "SHA256": "1D5491E3C468EE4B4EF6EDFF4BBC7D06EE83180F6F0B1576763EA2EFE049493A",
      "SystemTime": "2020-08-12T13:06:08.143703Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 4176,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-08-12 13:06:08.141",
      "Version": 5
    }
  ]
}]