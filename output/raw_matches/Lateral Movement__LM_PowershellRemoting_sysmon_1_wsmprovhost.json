[{
  "title": "Remote PowerShell Session Host Process (WinRM)",
  "id": "734f8d9b-42b8-41b2-bcf5-abaf49d5a3c8",
  "description": "Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session).",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE '%\\\\wsmprovhost.exe' ESCAPE '\\' OR ParentImage LIKE '%\\\\wsmprovhost.exe' ESCAPE '\\'))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.execution",
    "attack.lateral-movement",
    "attack.t1059.001",
    "attack.t1021.006"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\system32\\HOSTNAME.EXE\"",
      "Company": "Microsoft Corporation",
      "Computer": "DC1.insecurebank.local",
      "CurrentDirectory": "C:\\Users\\administrator\\Documents\\",
      "Description": "Hostname APP",
      "EventID": 1,
      "EventRecordID": 18002,
      "FileVersion": "6.3.9600.16384 (winblue_rtm.130821-1623)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=4ED8B225C9CC97DD02C9A5DFD9F733C353F83E36,MD5=74D1E6E8AC6ABCC1DE934C8C5E422B64,SHA256=CA40BB9470E8E73767F3AA43DDF51F814481167DEC6C2FAA1996C18AB2C621DB,IMPHASH=65F157041816229C2919A683CBA86F70",
      "IMPHASH": "65F157041816229C2919A683CBA86F70",
      "Image": "C:\\Windows\\System32\\HOSTNAME.EXE",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "DFAE8213-BEAD-5CDC-0000-0020AFDA1500",
      "LogonId": "0x15daaf",
      "MD5": "74D1E6E8AC6ABCC1DE934C8C5E422B64",
      "Opcode": 0,
      "OriginalLogfile": "LM_PowershellRemoting_sysmon_1_wsmprovhost.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\wsmprovhost.exe -Embedding",
      "ParentImage": "C:\\Windows\\System32\\wsmprovhost.exe",
      "ParentProcessGuid": "DFAE8213-BEAD-5CDC-0000-0010DDDB1500",
      "ParentProcessId": 3332,
      "ProcessGuid": "DFAE8213-BF0B-5CDC-0000-00105A951600",
      "ProcessID": 1792,
      "Product": "Microsoft速 Windows速 Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "RuleName": "Lateral Movement - Windows Remote Management",
      "SHA1": "4ED8B225C9CC97DD02C9A5DFD9F733C353F83E36",
      "SHA256": "CA40BB9470E8E73767F3AA43DDF51F814481167DEC6C2FAA1996C18AB2C621DB",
      "SystemTime": "2019-05-16T01:38:19.630865Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 2232,
      "User": "insecurebank\\Administrator",
      "UserID": "S-1-5-18",
      "UtcTime": "2019-05-16 01:38:19.616",
      "Version": 5
    }
  ]
},
{
  "title": "Suspicious Execution of Hostname",
  "id": "7be5fb68-f9ef-476d-8b51-0256ebece19e",
  "description": "Use of hostname to get information",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND Image LIKE '%\\\\HOSTNAME.EXE' ESCAPE '\\')"
  ],
  "rule_level": "low",
  "tags": [
    "attack.discovery",
    "attack.t1082"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 1,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\system32\\HOSTNAME.EXE\"",
      "Company": "Microsoft Corporation",
      "Computer": "DC1.insecurebank.local",
      "CurrentDirectory": "C:\\Users\\administrator\\Documents\\",
      "Description": "Hostname APP",
      "EventID": 1,
      "EventRecordID": 18002,
      "FileVersion": "6.3.9600.16384 (winblue_rtm.130821-1623)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=4ED8B225C9CC97DD02C9A5DFD9F733C353F83E36,MD5=74D1E6E8AC6ABCC1DE934C8C5E422B64,SHA256=CA40BB9470E8E73767F3AA43DDF51F814481167DEC6C2FAA1996C18AB2C621DB,IMPHASH=65F157041816229C2919A683CBA86F70",
      "IMPHASH": "65F157041816229C2919A683CBA86F70",
      "Image": "C:\\Windows\\System32\\HOSTNAME.EXE",
      "IntegrityLevel": "High",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "DFAE8213-BEAD-5CDC-0000-0020AFDA1500",
      "LogonId": "0x15daaf",
      "MD5": "74D1E6E8AC6ABCC1DE934C8C5E422B64",
      "Opcode": 0,
      "OriginalLogfile": "LM_PowershellRemoting_sysmon_1_wsmprovhost.evtx",
      "ParentCommandLine": "C:\\Windows\\system32\\wsmprovhost.exe -Embedding",
      "ParentImage": "C:\\Windows\\System32\\wsmprovhost.exe",
      "ParentProcessGuid": "DFAE8213-BEAD-5CDC-0000-0010DDDB1500",
      "ParentProcessId": 3332,
      "ProcessGuid": "DFAE8213-BF0B-5CDC-0000-00105A951600",
      "ProcessID": 1792,
      "Product": "Microsoft速 Windows速 Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "RuleName": "Lateral Movement - Windows Remote Management",
      "SHA1": "4ED8B225C9CC97DD02C9A5DFD9F733C353F83E36",
      "SHA256": "CA40BB9470E8E73767F3AA43DDF51F814481167DEC6C2FAA1996C18AB2C621DB",
      "SystemTime": "2019-05-16T01:38:19.630865Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 2232,
      "User": "insecurebank\\Administrator",
      "UserID": "S-1-5-18",
      "UtcTime": "2019-05-16 01:38:19.616",
      "Version": 5
    }
  ]
}]