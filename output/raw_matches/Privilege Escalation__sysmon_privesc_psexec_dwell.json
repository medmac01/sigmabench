[{
  "title": "PsExec Service Child Process Execution as LOCAL SYSTEM",
  "id": "7c0dcd3d-acf8-4f71-9570-f448b0034f94",
  "description": "Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account)",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (ParentImage LIKE 'C:\\\\Windows\\\\PSEXESVC.exe' ESCAPE '\\' AND (User LIKE '%AUTHORI%' ESCAPE '\\' OR User LIKE '%AUTORI%' ESCAPE '\\')))"
  ],
  "rule_level": "high",
  "tags": [
    "attack.execution"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 10,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "\"C:\\Windows\\System32\\mspaint.exe\" 췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍췍",
      "Company": "Microsoft Corporation",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "Paint",
      "EventID": 1,
      "EventRecordID": 549487,
      "FileVersion": "10.0.17763.1 (WinBuild.160101.0800)",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=8956D4DFF2E321B7308D7FDD8BD32BF47D61F398,MD5=67C68B11E98970966DF59D2FAD6152BF,SHA256=615CFFE98CAD0DB5F7F261CE915F13BBBC22378BB2A80591D38205D5658A8092,IMPHASH=ABBE6AE1A46B5D03FCCC5A2C2F1DF4D0",
      "IMPHASH": "ABBE6AE1A46B5D03FCCC5A2C2F1DF4D0",
      "Image": "C:\\Windows\\System32\\mspaint.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-76FA-5FD1-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "67C68B11E98970966DF59D2FAD6152BF",
      "Opcode": 0,
      "OriginalFileName": "MSPAINT.EXE",
      "OriginalLogfile": "sysmon_privesc_psexec_dwell.evtx",
      "ParentCommandLine": "C:\\Windows\\PSEXESVC.exe",
      "ParentImage": "C:\\Windows\\PSEXESVC.exe",
      "ParentProcessGuid": "747F3D96-00D9-5FD1-0000-001021855301",
      "ParentProcessId": 16344,
      "ProcessGuid": "747F3D96-00DD-5FD1-0000-0010F7D25301",
      "ProcessID": 3572,
      "Product": "Microsoft® Windows® Operating System",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "8956D4DFF2E321B7308D7FDD8BD32BF47D61F398",
      "SHA256": "615CFFE98CAD0DB5F7F261CE915F13BBBC22378BB2A80591D38205D5658A8092",
      "SystemTime": "2020-12-09T16:52:45.141993Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 5040,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-09 16:52:45.011",
      "Version": 5
    }
  ]
},
{
  "title": "PsExec Service Execution",
  "id": "fdfcbd78-48f1-4a4b-90ac-d82241e368c5",
  "description": "Detects launch of the PSEXESVC service, which means that this system was the target of a psexec remote execution",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND (EventID=1 AND (Image LIKE 'C:\\\\Windows\\\\PSEXESVC.exe' ESCAPE '\\' OR OriginalFileName='psexesvc.exe'))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.execution"
  ],
  "count": 1,
  "matches": [
    {
      "row_id": 5,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "CommandLine": "C:\\Windows\\PSEXESVC.exe",
      "Company": "Sysinternals",
      "Computer": "MSEDGEWIN10",
      "CurrentDirectory": "C:\\Windows\\system32\\",
      "Description": "PsExec Service",
      "EventID": 1,
      "EventRecordID": 549482,
      "FileVersion": "2.2",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Hashes": "SHA1=A17C21B909C56D93D978014E63FB06926EAEA8E7,MD5=75B55BB34DAC9D02740B9AD6B6820360,SHA256=141B2190F51397DBD0DFDE0E3904B264C91B6F81FEBC823FF0C33DA980B69944,IMPHASH=67012475995FB9027F4511245B57DDEA",
      "IMPHASH": "67012475995FB9027F4511245B57DDEA",
      "Image": "C:\\Windows\\PSEXESVC.exe",
      "IntegrityLevel": "System",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "LogonGuid": "747F3D96-76FA-5FD1-0000-0020E7030000",
      "LogonId": "0x3e7",
      "MD5": "75B55BB34DAC9D02740B9AD6B6820360",
      "Opcode": 0,
      "OriginalFileName": "psexesvc.exe",
      "OriginalLogfile": "sysmon_privesc_psexec_dwell.evtx",
      "ParentCommandLine": "?",
      "ParentImage": "?",
      "ParentProcessGuid": "00000000-0000-0000-0000-000000000000",
      "ParentProcessId": 632,
      "ProcessGuid": "747F3D96-00D9-5FD1-0000-001021855301",
      "ProcessID": 3572,
      "Product": "Sysinternals PsExec",
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SHA1": "A17C21B909C56D93D978014E63FB06926EAEA8E7",
      "SHA256": "141B2190F51397DBD0DFDE0E3904B264C91B6F81FEBC823FF0C33DA980B69944",
      "SystemTime": "2020-12-09T16:52:41.861437Z",
      "Task": 1,
      "TerminalSessionId": 0,
      "ThreadID": 5040,
      "User": "NT AUTHORITY\\SYSTEM",
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-09 16:52:41.853",
      "Version": 5
    }
  ]
},
{
  "title": "PsExec Tool Execution From Suspicious Locations - PipeName",
  "id": "41504465-5e3a-4a5b-a5b4-2a0baadd4463",
  "description": "Detects PsExec default pipe creation where the image executed is located in a suspicious location. Which could indicate that the tool is being used in an attack",
  "sigmafile": "",
  "sigma": [
    "SELECT * FROM logs WHERE Channel='Microsoft-Windows-Sysmon/Operational' AND ((EventID=17 OR EventID=18) AND (PipeName LIKE '\\\\PSEXESVC' ESCAPE '\\' AND (Image LIKE '%:\\\\Users\\\\Public\\\\%' ESCAPE '\\' OR Image LIKE '%:\\\\Windows\\\\Temp\\\\%' ESCAPE '\\' OR Image LIKE '%\\\\AppData\\\\Local\\\\Temp\\\\%' ESCAPE '\\' OR Image LIKE '%\\\\Desktop\\\\%' ESCAPE '\\' OR Image LIKE '%\\\\Downloads\\\\%' ESCAPE '\\')))"
  ],
  "rule_level": "medium",
  "tags": [
    "attack.execution",
    "attack.t1569.002",
    "attack.s0029"
  ],
  "count": 2,
  "matches": [
    {
      "row_id": 4,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "EventID": 17,
      "EventRecordID": 549481,
      "EventType": "CreatePipe",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Users\\Public\\psexecprivesc.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_privesc_psexec_dwell.evtx",
      "PipeName": "\\PSEXESVC",
      "ProcessGuid": "747F3D96-00D2-5FD1-0000-0010FA4C5301",
      "ProcessID": 3572,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2020-12-09T16:52:34.622041Z",
      "Task": 17,
      "ThreadID": 5040,
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-09 16:52:34.611",
      "Version": 1
    },
    {
      "row_id": 9,
      "Channel": "Microsoft-Windows-Sysmon/Operational",
      "Computer": "MSEDGEWIN10",
      "EventID": 18,
      "EventRecordID": 549486,
      "EventType": "ConnectPipe",
      "Guid": "5770385F-C22A-43E0-BF4C-06F5698FFBD9",
      "Image": "C:\\Users\\Public\\psexecprivesc.exe",
      "Keywords": "0x8000000000000000",
      "Level": 4,
      "Opcode": 0,
      "OriginalLogfile": "sysmon_privesc_psexec_dwell.evtx",
      "PipeName": "\\PSEXESVC",
      "ProcessGuid": "747F3D96-00D2-5FD1-0000-0010FA4C5301",
      "ProcessID": 3572,
      "Provider_Name": "Microsoft-Windows-Sysmon",
      "SystemTime": "2020-12-09T16:52:44.864937Z",
      "Task": 18,
      "ThreadID": 5040,
      "UserID": "S-1-5-18",
      "UtcTime": "2020-12-09 16:52:44.863",
      "Version": 1
    }
  ]
}]